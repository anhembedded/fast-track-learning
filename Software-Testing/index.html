<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Unit Test Wiki</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <i data-feather="box"></i>
                <h1>Dev Unit Test Wiki</h1>
            </div>
        </header>

        <nav class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item active" data-target="home">
                    <i data-feather="home"></i>
                    <span>Trang ch·ªß</span>
                </li>
                <li class="nav-item" data-target="getting-started">
                    <i data-feather="play-circle"></i>
                    <span>B·∫Øt ƒë·∫ßu</span>
                </li>
                <li class="nav-category">Thi·∫øt k·∫ø Test</li>
                <li class="nav-item" data-target="structuring-metrics">
                    <i data-feather="layout"></i>
                    <span>C·∫•u tr√∫c v√† Ch·ªâ s·ªë</span>
                </li>
                <li class="nav-item" data-target="london-vs-classical">
                    <i data-feather="git-pull-request"></i>
                    <span>London vs. Classical</span>
                </li>
                <li class="nav-item" data-target="test-data-patterns">
                    <i data-feather="database"></i>
                    <span>M·∫´u d·ªØ li·ªáu Test</span>
                </li>
                <li class="nav-category">Nguy√™n t·∫Øc C·ªët l√µi</li>
                <li class="nav-item" data-target="four-pillars">
                    <i data-feather="shield"></i>
                    <span>B·ªën tr·ª• c·ªôt</span>
                </li>
                <li class="nav-item" data-target="behavior-vs-implementation">
                    <i data-feather="cpu"></i>
                    <span>Behavior vs. Implementation</span>
                </li>
                <li class="nav-category">Ch·ªß ƒë·ªÅ N√¢ng cao</li>
                <li class="nav-item" data-target="test-doubles">
                    <i data-feather="copy"></i>
                    <span>Test Doubles (Mocks & Stubs)</span>
                </li>
                <li class="nav-item" data-target="architecture-mocking">
                    <i data-feather="git-branch"></i>
                    <span>Ki·∫øn tr√∫c v√† Mocking</span>
                </li>
                <li class="nav-category">Th·ª±c h√†nh (Hands-on)</li>
                <li class="nav-item" data-target="pytest-hands-on">
                    <i data-feather="terminal"></i>
                    <span>PyTest</span>
                </li>
                <li class="nav-item" data-target="gtest-hands-on">
                    <i data-feather="code"></i>
                    <span>GTest</span>
                </li>
                <li class="nav-category">T√†i nguy√™n</li>
                <li class="nav-item" data-target="glossary">
                    <i data-feather="book-open"></i>
                    <span>T·ª´ ƒëi·ªÉn thu·∫≠t ng·ªØ</span>
                </li>
                <li class="nav-category">Concurrency & Systems</li>
                <li class="nav-item" data-target="concurrency-intro">
                    <i data-feather="server"></i>
                    <span>Introduction</span>
                </li>
                <li class="nav-item" data-target="concurrency-processes">
                    <i data-feather="cpu"></i>
                    <span>Processes & Signals</span>
                </li>
                <li class="nav-item" data-target="concurrency-posix-threads">
                    <i data-feather="git-merge"></i>
                    <span>POSIX Threads</span>
                </li>
                <li class="nav-item" data-target="concurrency-python">
                    <i data-feather="wind"></i>
                    <span>Python Concurrency</span>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <section id="home" class="content-section active">
                <h1>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Wiki Unit Test</h1>
                <p>ƒê√¢y l√† trang t√†i li·ªáu t·ªïng h·ª£p c√°c ki·∫øn th·ª©c, nguy√™n t·∫Øc v√† b√†i h·ªçc th·ª±c t·∫ø v·ªÅ <span class="keyword" data-keyword="unit-testing">Unit Testing</span> trong ph√°t tri·ªÉn ph·∫ßn m·ªÅm. M·ª•c ti√™u c·ªßa trang wiki n√†y l√† bi·∫øn nh·ªØng ki·∫øn th·ª©c ph·ª©c t·∫°p th√†nh m·ªôt ngu·ªìn t√†i li·ªáu <strong>d·ªÖ h·ªçc, d·ªÖ tra c·ª©u</strong> cho c√°c l·∫≠p tr√¨nh vi√™n.</p>

                <h2>T√≥m t·∫Øt c·ªët l√µi</h2>
                <ul>
                    <li><strong><span class="keyword" data-keyword="unit-testing">Unit testing</span> l√† m·ªôt m·∫°ng l∆∞·ªõi an to√†n (safety net)</strong> gi√∫p ph√°t hi·ªán l·ªói h·ªìi quy (<span class="keyword" data-keyword="regression">regressions</span>) v√† duy tr√¨ t·ªëc ƒë·ªô ph√°t tri·ªÉn c·ªßa d·ª± √°n v·ªÅ l√¢u d√†i.</li>
                    <li>N·∫øu code c·ªßa b·∫°n <strong>kh√≥ ƒë·ªÉ vi·∫øt unit test</strong>, ƒë√≥ th∆∞·ªùng l√† m·ªôt d·∫•u hi·ªáu c·ªßa thi·∫øt k·∫ø k√©m (v√≠ d·ª•: <span class="keyword" data-keyword="tight-coupling">tight coupling</span> - li√™n k·∫øt ch·∫∑t ch·∫Ω). Ng∆∞·ª£c l·∫°i, code d·ªÖ test kh√¥ng ƒë·∫£m b·∫£o r·∫±ng ƒë√≥ l√† code ho√†n h·∫£o.</li>
                    <li><strong>M·ª•c ti√™u ch√≠nh khi vi·∫øt test:</strong>
                        <ol>
                            <li>Ph√°t hi·ªán l·ªói h·ªìi quy m·ªôt c√°ch hi·ªáu qu·∫£.</li>
                            <li>Gi·∫£m chi ph√≠ b·∫£o tr√¨ b·ªô test.</li>
                            <li>Cho ph√©p t√°i c·∫•u tr√∫c (<span class="keyword" data-keyword="refactor">refactor</span>) code m·ªôt c√°ch an to√†n v√† t·ª± tin.</li>
                        </ol>
                    </li>
                    <li><strong>Kh√¥ng c√≥ test:</strong> D·ª± √°n c√≥ th·ªÉ ph√°t tri·ªÉn nhanh l√∫c ƒë·∫ßu, nh∆∞ng s·∫Ω ch·∫≠m l·∫°i ƒë√°ng k·ªÉ v·ªÅ sau do s·ª± entropy c·ªßa m√£ ngu·ªìn (code ng√†y c√†ng ph·ª©c t·∫°p, r·ªëi r·∫Øm v√† d·ªÖ h·ªèng).</li>
                    <li><strong>C√≥ test:</strong> Vi·ªác s·ª≠a ƒë·ªïi v√† t√°i c·∫•u tr√∫c code tr·ªü n√™n an to√†n h∆°n, gi√∫p d·ª± √°n duy tr√¨ ƒë∆∞·ª£c ch·∫•t l∆∞·ª£ng v√† t·ªëc ƒë·ªô.</li>
                </ul>

                <blockquote>
                    <p>Code kh√¥ng ph·∫£i l√† m·ªôt t√†i s·∫£n (asset), n√≥ l√† m·ªôt kho·∫£n n·ª£ (liability). Code c√†ng nhi·ªÅu, r·ªßi ro ti·ªÅm ·∫©n bug c√†ng l·ªõn. <span class="keyword" data-keyword="unit-test">Unit test</span> ch√≠nh l√† "t·∫•m khi√™n" b·∫£o v·ªá b·∫°n kh·ªèi kho·∫£n n·ª£ ƒë√≥.</p>
                </blockquote>
                <p>H√£y b·∫Øt ƒë·∫ßu kh√°m ph√° c√°c ch·ªß ƒë·ªÅ chi ti·∫øt h∆°n qua thanh ƒëi·ªÅu h∆∞·ªõng b√™n tr√°i!</p>
            </section>

            <section id="getting-started" class="content-section">
                <h1>B·∫Øt ƒë·∫ßu v·ªõi Unit Test</h1>
                <p>Ph·∫ßn n√†y s·∫Ω gi·ªõi thi·ªáu nh·ªØng kh√°i ni·ªám n·ªÅn t·∫£ng nh·∫•t m√† b·∫°n c·∫ßn n·∫Øm v·ªØng tr∆∞·ªõc khi ƒëi s√¢u v√†o c√°c k·ªπ thu·∫≠t chi ti·∫øt.</p>

                <h2>‚úÖ Test T·ªët vs. Test T·ªìi</h2>
                <p>M·ªôt b√†i test ƒë∆∞·ª£c coi l√† <strong>"t·ªët"</strong> khi n√≥ mang l·∫°i gi√° tr·ªã cao v·ªõi chi ph√≠ b·∫£o tr√¨ th·∫•p. Ng∆∞·ª£c l·∫°i, m·ªôt b√†i test <strong>"t·ªìi"</strong> s·∫Ω tr·ªü th√†nh g√°nh n·∫∑ng cho d·ª± √°n.</p>
                <ul>
                    <li><strong>Test T·ªët:</strong>
                        <ul>
                            <li>Ch·∫°y nhanh.</li>
                            <li>M·ª•c ƒë√≠ch r√µ r√†ng, d·ªÖ ƒë·ªçc.</li>
                            <li>ƒê·ªôc l·∫≠p, kh√¥ng ph·ª• thu·ªôc v√†o c√°c test kh√°c.</li>
                            <li>√çt chi ph√≠ b·∫£o tr√¨ khi code thay ƒë·ªïi (ch·ªëng ch·ªãu ƒë∆∞·ª£c <span class="keyword" data-keyword="refactor">refactor</span>).</li>
                            <li>T·∫≠p trung v√†o c√°c h√†nh vi (behavior) quan tr·ªçng c·ªßa h·ªá th·ªëng.</li>
                        </ul>
                    </li>
                    <li><strong>Test T·ªìi:</strong>
                        <ul>
                            <li>Ch·∫°y ch·∫≠m.</li>
                            <li>D·ªÖ b·ªã "v·ª°" (fail) d√π logic c·ªßa ·ª©ng d·ª•ng v·∫´n ƒë√∫ng.</li>
                            <li>C√≥ nhi·ªÅu code th·ª´a (<span class="keyword" data-keyword="boilerplate">boilerplate</span>).</li>
                            <li>G√¢y ra c√°c c·∫£nh b√°o gi·∫£ (<span class="keyword" data-keyword="false-positive">false positive</span>), l√†m m·∫•t ni·ªÅm tin c·ªßa l·∫≠p tr√¨nh vi√™n.</li>
                            <li>B·ªã tr√πng l·∫∑p (<span class="keyword" data-keyword="redundant">redundant</span>) v·ªõi c√°c test kh√°c.</li>
                        </ul>
                    </li>
                </ul>

                <h2>Ph√¢n lo·∫°i c√°c c·∫•p ƒë·ªô Test</h2>
                <p>Trong ph√°t tri·ªÉn ph·∫ßn m·ªÅm, c√≥ nhi·ªÅu c·∫•p ƒë·ªô ki·ªÉm th·ª≠ kh√°c nhau, m·ªói lo·∫°i c√≥ m·ªôt m·ª•c ƒë√≠ch ri√™ng. Ba lo·∫°i ph·ªï bi·∫øn nh·∫•t th∆∞·ªùng ƒë∆∞·ª£c minh h·ªça qua m√¥ h√¨nh <span class="keyword" data-keyword="test-pyramid">Kim t·ª± th√°p Ki·ªÉm th·ª≠</span>.</p>
                <ol>
                    <li><strong><span class="keyword" data-keyword="unit-test">Unit Test</span> (Ki·ªÉm th·ª≠ ƒë∆°n v·ªã):</strong>
                        <p><strong>M·ª•c ti√™u:</strong> Ki·ªÉm tra m·ªôt ƒë∆°n v·ªã (unit) code nh·ªè v√† c√¥ l·∫≠p (v√≠ d·ª•: m·ªôt h√†m, m·ªôt class).<br>
                        <strong>ƒê·∫∑c ƒëi·ªÉm:</strong> Ch·∫°y ho√†n to√†n trong b·ªô nh·ªõ (in-memory), kh√¥ng ph·ª• thu·ªôc v√†o c√°c h·ªá th·ªëng b√™n ngo√†i nh∆∞ <span class="keyword" data-keyword="database">database</span>, file system hay network. R·∫•t nhanh.</p>
                    </li>
                    <li><strong><span class="keyword" data-keyword="integration-test">Integration Test</span> (Ki·ªÉm th·ª≠ t√≠ch h·ª£p):</strong>
                        <p><strong>M·ª•c ti√™u:</strong> Ki·ªÉm tra s·ª± t∆∞∆°ng t√°c v√† ph·ªëi h·ª£p gi·ªØa hai hay nhi·ªÅu th√†nh ph·∫ßn c·ªßa h·ªá th·ªëng, ho·∫∑c gi·ªØa h·ªá th·ªëng c·ªßa b·∫°n v√† m·ªôt h·ªá th·ªëng b√™n ngo√†i (<span class="keyword" data-keyword="database">database</span>, <span class="keyword" data-keyword="api">API</span> c·ªßa b√™n th·ª© ba).<br>
                        <strong>ƒê·∫∑c ƒëi·ªÉm:</strong> Ch·∫≠m h∆°n <span class="keyword" data-keyword="unit-test">Unit Test</span> v√¨ c·∫ßn truy c·∫≠p v√†o c√°c t√†i nguy√™n ngo√†i process.</p>
                    </li>
                    <li><strong><span class="keyword" data-keyword="e2e-test">End-to-end (E2E) Test</span> (Ki·ªÉm th·ª≠ ƒë·∫ßu-cu·ªëi):</strong>
                        <p><strong>M·ª•c ti√™u:</strong> Ki·ªÉm tra to√†n b·ªô lu·ªìng ho·∫°t ƒë·ªông c·ªßa ·ª©ng d·ª•ng t·ª´ g√≥c nh√¨n c·ªßa ng∆∞·ªùi d√πng cu·ªëi.<br>
                        <strong>ƒê·∫∑c ƒëi·ªÉm:</strong> M√¥ ph·ªèng m·ªôt ng∆∞·ªùi d√πng th·∫≠t, t∆∞∆°ng t√°c t·ª´ giao di·ªán ng∆∞·ªùi d√πng (UI) xu·ªëng t·ªõi <span class="keyword" data-keyword="database">database</span>. R·∫•t ch·∫≠m v√† chi ph√≠ b·∫£o tr√¨ cao.</p>
                    </li>
                </ol>

                <h2>M√¥ h√¨nh <span class="keyword" data-keyword="test-pyramid">Kim t·ª± th√°p Ki·ªÉm th·ª≠ (Test Pyramid)</span></h2>
                <p>ƒê√¢y l√† m·ªôt m√¥ h√¨nh tr·ª±c quan gi√∫p ƒë·ªãnh h∆∞·ªõng chi·∫øn l∆∞·ª£c vi·∫øt test: h√£y vi·∫øt th·∫≠t nhi·ªÅu <span class="keyword" data-keyword="unit-test">Unit Test</span>, √≠t h∆°n <span class="keyword" data-keyword="integration-test">Integration Test</span> v√† s·ªë l∆∞·ª£ng <span class="keyword" data-keyword="e2e-test">E2E Test</span> l√† √≠t nh·∫•t.</p>
                <img src="images/test_pyramid.svg" alt="Test Pyramid">
            </section>

            <section id="structuring-metrics" class="content-section">
                <h1>C·∫•u tr√∫c v√† ƒê√°nh gi√° Test</h1>
                <p>Sau khi n·∫Øm ƒë∆∞·ª£c c√°c kh√°i ni·ªám c∆° b·∫£n, b∆∞·ªõc ti·∫øp theo l√† t√¨m hi·ªÉu c√°ch c·∫•u tr√∫c m·ªôt b√†i test cho d·ªÖ ƒë·ªçc v√† c√°ch ƒë√°nh gi√° b·ªô test c·ªßa b·∫°n m·ªôt c√°ch ƒë√∫ng ƒë·∫Øn.</p>

                <h2>M·∫´u <span class="keyword" data-keyword="aaa">AAA ‚Äî Arrange / Act / Assert</span></h2>
                <p>ƒê√¢y l√† m·ªôt m·∫´u c·∫•u tr√∫c (pattern) c·ª±c k·ª≥ ph·ªï bi·∫øn gi√∫p cho c√°c b√†i test tr·ªü n√™n r√µ r√†ng v√† nh·∫•t qu√°n. M·ªôt b√†i test n√™n ƒë∆∞·ª£c chia th√†nh 3 ph·∫ßn ri√™ng bi·ªát:</p>
                <ol>
                    <li><strong>Arrange (S·∫Øp ƒë·∫∑t):</strong>
                        <p><strong>M·ª•c ƒë√≠ch:</strong> Chu·∫©n b·ªã m·ªçi th·ª© c·∫ßn thi·∫øt ƒë·ªÉ b√†i test c√≥ th·ªÉ ch·∫°y.<br>
                        <strong>C√¥ng vi·ªác:</strong> Kh·ªüi t·∫°o ƒë·ªëi t∆∞·ª£ng, chu·∫©n b·ªã d·ªØ li·ªáu ƒë·∫ßu v√†o, thi·∫øt l·∫≠p c√°c <span class="keyword" data-keyword="mock">mock</span>/<span class="keyword" data-keyword="stub">stub</span>.</p>
                    </li>
                    <li><strong>Act (H√†nh ƒë·ªông):</strong>
                        <p><strong>M·ª•c ƒë√≠ch:</strong> Th·ª±c thi h√†nh vi (behavior) m√† b·∫°n mu·ªën ki·ªÉm tra.<br>
                        <strong>C√¥ng vi·ªác:</strong> G·ªçi ph∆∞∆°ng th·ª©c ho·∫∑c h√†m c·∫ßn test. Th√¥ng th∆∞·ªùng, ph·∫ßn n√†y ch·ªâ n√™n c√≥ m·ªôt d√≤ng code duy nh·∫•t.</p>
                    </li>
                    <li><strong>Assert (X√°c minh):</strong>
                        <p><strong>M·ª•c ƒë√≠ch:</strong> Ki·ªÉm tra xem k·∫øt qu·∫£ c·ªßa h√†nh ƒë·ªông c√≥ ƒë√∫ng nh∆∞ mong ƒë·ª£i hay kh√¥ng.<br>
                        <strong>C√¥ng vi·ªác:</strong> So s√°nh k·∫øt qu·∫£ tr·∫£ v·ªÅ ho·∫∑c tr·∫°ng th√°i c·ªßa ƒë·ªëi t∆∞·ª£ng v·ªõi m·ªôt gi√° tr·ªã k·ª≥ v·ªçng.</p>
                    </li>
                </ol>

                <div class="practice-link-box">
                    <p>üí° <strong>Xem th·ª±c h√†nh:</strong> ƒê·ªÉ xem c√°ch √°p d·ª•ng m·∫´u AAA v√†o th·ª±c t·∫ø, h√£y tham kh·∫£o c√°c v√≠ d·ª• trong ph·∫ßn <a href="#" class="nav-item" data-target="pytest-hands-on">Th·ª±c h√†nh PyTest</a> v√† <a href="#" class="nav-item" data-target="gtest-hands-on">Th·ª±c h√†nh GTest</a>.</p>
                </div>

                <h3>S∆° ƒë·ªì tu·∫ßn t·ª± c·ªßa m·∫´u AAA</h3>
                <p>S∆° ƒë·ªì n√†y minh h·ªça lu·ªìng ho·∫°t ƒë·ªông c·ªßa m·ªôt b√†i test theo m·∫´u AAA.</p>
                <img src="images/aaa_pattern_sequence.svg" alt="AAA Pattern Sequence">

                <h2>C√°c ch·ªâ s·ªë <span class="keyword" data-keyword="code-coverage">ƒê·ªô bao ph·ªß (Coverage Metrics)</span> ‚Äî Hi·ªÉu cho ƒë√∫ng</h2>
                <p><span class="keyword" data-keyword="code-coverage">ƒê·ªô bao ph·ªß (code coverage)</span> l√† m·ªôt ch·ªâ s·ªë ƒëo l∆∞·ªùng t·ª∑ l·ªá code c·ªßa b·∫°n ƒë∆∞·ª£c th·ª±c thi b·ªüi c√°c b√†i test. Tuy nhi√™n, ƒë√¢y l√† m·ªôt ch·ªâ s·ªë r·∫•t d·ªÖ b·ªã hi·ªÉu sai.</p>
                <ul>
                    <li><strong>Line coverage (ƒê·ªô ph·ªß d√≤ng l·ªánh):</strong> T·ª∑ l·ªá ph·∫ßn trƒÉm s·ªë d√≤ng code ƒë√£ ƒë∆∞·ª£c ch·∫°y qua b·ªüi b·ªô test.</li>
                    <li><strong>Branch coverage (ƒê·ªô ph·ªß nh√°nh):</strong> T·ª∑ l·ªá ph·∫ßn trƒÉm c√°c nh√°nh quy·∫øt ƒë·ªãnh (v√≠ d·ª•: <code>if/else</code>, <code>switch/case</code>) ƒë√£ ƒë∆∞·ª£c th·ª±c thi. ƒê√¢y l√† ch·ªâ s·ªë quan tr·ªçng h∆°n line coverage.</li>
                </ul>

                <h3>C√¥ng th·ª©c t√≠nh Branch Coverage</h3>
                <blockquote>
                    <p>Branch coverage = (S·ªë nh√°nh ƒë√£ ƒë∆∞·ª£c test ch·∫°y qua) / (T·ªïng s·ªë nh√°nh trong m√£ ngu·ªìn)</p>
                </blockquote>

                <h3>Coverage l√† m·ªôt ch·ªâ b√°o, kh√¥ng ph·∫£i m·ª•c ti√™u</h3>
                <p>H√£y nh·ªõ r·∫±ng, coverage l√† m·ªôt c√¥ng c·ª• ƒë·ªÉ t√¨m ra nh·ªØng ph·∫ßn code <strong>ch∆∞a ƒë∆∞·ª£c test</strong>, ch·ª© kh√¥ng ph·∫£i l√† th∆∞·ªõc ƒëo ch·∫•t l∆∞·ª£ng c·ªßa b·ªô test.</p>
                <ul>
                    <li><strong>Coverage th·∫•p (v√≠ d·ª•: < 50%):</strong> Ch·∫Øc ch·∫Øn l√† m·ªôt d·∫•u hi·ªáu x·∫•u. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† m·ªôt ph·∫ßn l·ªõn code c·ªßa b·∫°n ch∆∞a h·ªÅ ƒë∆∞·ª£c ki·ªÉm tra.</li>
                    <li><strong>Coverage cao (v√≠ d·ª•: 90-100%):</strong> <strong>Kh√¥ng ƒë·∫£m b·∫£o</strong> r·∫±ng b·ªô test c·ªßa b·∫°n t·ªët. M·ªôt b√†i test c√≥ th·ªÉ ch·∫°y qua 100% d√≤ng code nh∆∞ng l·∫°i thi·∫øu c√°c <code>assert</code> quan tr·ªçng, ho·∫∑c ch·ªâ ki·ªÉm tra nh·ªØng th·ª© t·∫ßm th∆∞·ªùng.</li>
                </ul>
                <p><strong>L·ªùi khuy√™n:</strong> ƒê·ª´ng ƒëu·ªïi theo con s·ªë coverage. H√£y t·∫≠p trung v√†o vi·ªác vi·∫øt nh·ªØng b√†i test c√≥ √Ω nghƒ©a, ki·ªÉm tra c√°c logic nghi·ªáp v·ª• quan tr·ªçng.</p>
            </section>

            <section id="london-vs-classical" class="content-section">
                <h1>Hai tr∆∞·ªùng ph√°i Unit Testing: London vs. Classical</h1>
                <p>Trong c·ªông ƒë·ªìng ph√°t tri·ªÉn ph·∫ßn m·ªÅm, c√≥ hai tr∆∞·ªùng ph√°i t∆∞ duy ch√≠nh v·ªÅ c√°ch ti·∫øp c·∫≠n <span class="keyword" data-keyword="unit-testing">unit testing</span>, ƒë·∫∑c bi·ªát l√† v·ªÅ v·∫•n ƒë·ªÅ "c√°ch ly" (isolation) v√† vi·ªác s·ª≠ d·ª•ng c√°c ƒë·ªëi t∆∞·ª£ng gi·∫£ (<span class="keyword" data-keyword="test-double">test doubles</span>).</p>

                <h2>So s√°nh t·ªïng quan</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Ti√™u ch√≠</th>
                            <th>Tr∆∞·ªùng ph√°i London (Mockist)</th>
                            <th>Tr∆∞·ªùng ph√°i Classical (Classicist)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ƒê·ªãnh nghƒ©a "Unit"</strong></td>
                            <td>M·ªôt class duy nh·∫•t.</td>
                            <td>M·ªôt ƒë∆°n v·ªã h√†nh vi (c√≥ th·ªÉ g·ªìm nhi·ªÅu class).</td>
                        </tr>
                        <tr>
                            <td><strong>ƒê·ªëi t∆∞·ª£ng Mock</strong></td>
                            <td>M·ªçi dependency (k·ªÉ c·∫£ class n·ªôi b·ªô).</td>
                            <td>Ch·ªâ dependency ngo√†i (I/O: network, DB...).</td>
                        </tr>
                        <tr>
                            <td><strong>Lo·∫°i Test</strong></td>
                            <td>Ki·ªÉm tra t∆∞∆°ng t√°c (Interaction Testing).</td>
                            <td>Ki·ªÉm tra tr·∫°ng th√°i (State Testing).</td>
                        </tr>
                        <tr>
                            <td><strong>Kh·∫£ nƒÉng ch·ªëng ch·ªãu Refactor</strong></td>
                            <td>Th·∫•p üëé (Test d·ªÖ h·ªèng).</td>
                            <td>Cao üëç (Test b·ªÅn v·ªØng).</td>
                        </tr>
                        <tr>
                            <td><strong>M·ª©c ƒë·ªô c√¥ l·∫≠p</strong></td>
                            <td>C√¥ l·∫≠p class ƒëang test.</td>
                            <td>C√¥ l·∫≠p gi·ªØa c√°c b√†i test v·ªõi nhau.</td>
                        </tr>
                    </tbody>
                </table>

                <h2>V√≠ d·ª• th·ª±c t·∫ø: Chuy·ªÉn ti·ªÅn</h2>
                <p>H√£y xem x√©t m·ªôt v√≠ d·ª•: User A chuy·ªÉn 100$ cho User B. Logic n√†y ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi `AccountService`, v√† `AccountService` s·ª≠ d·ª•ng m·ªôt `Ledger` ƒë·ªÉ ghi l·∫°i giao d·ªãch.</p>
<pre><code class="language-python"># a_service.py
class Ledger:
    def record_transaction(self, from_acc, to_acc, amount):
        # ... logic ghi v√†o s·ªï s√°ch ...
        print(f"Recorded ${amount} from {from_acc} to {to_acc}")

class AccountService:
    def __init__(self, ledger: Ledger):
        self._ledger = ledger

    def transfer(self, from_acc, to_acc, amount):
        # ... logic ki·ªÉm tra s·ªë d∆∞, v.v...
        self._ledger.record_transaction(from_acc, to_acc, amount)
        return True
</code></pre>

                <div class="example-box">
                    <h3>C√°ch test c·ªßa tr∆∞·ªùng ph√°i London (Mockist)</h3>
                    <p>Tr∆∞·ªùng ph√°i n√†y s·∫Ω <strong>mock</strong> `Ledger` v√† x√°c minh r·∫±ng ph∆∞∆°ng th·ª©c `record_transaction` ƒë∆∞·ª£c g·ªçi ƒë√∫ng.</p>
<pre><code class="language-python">from unittest.mock import Mock
from a_service import AccountService

def test_transfer_calls_ledger_correctly_LONDON(mocker):
    # Arrange
    mock_ledger = mocker.Mock() # Mock dependency
    service = AccountService(ledger=mock_ledger)

    # Act
    service.transfer("A", "B", 100)

    # Assert (Ki·ªÉm tra t∆∞∆°ng t√°c - Interaction)
    mock_ledger.record_transaction.assert_called_once_with("A", "B", 100)
</code></pre>
                    <p><strong>V·∫•n ƒë·ªÅ:</strong> N·∫øu sau n√†y b·∫°n ƒë·ªïi t√™n `record_transaction` th√†nh `log_transaction` (m·ªôt ho·∫°t ƒë·ªông <span class="keyword" data-keyword="refactor">refactor</span>), b√†i test n√†y s·∫Ω <strong>th·∫•t b·∫°i</strong>, d√π ch·ª©c nƒÉng chuy·ªÉn ti·ªÅn v·∫´n ho·∫°t ƒë·ªông ƒë√∫ng. ƒê√¢y l√† m·ªôt <strong>b√°o ƒë·ªông gi·∫£ (<span class="keyword" data-keyword="false-positive">false positive</span>)</strong>.</p>
                </div>

                <div class="example-box">
                    <h3>C√°ch test c·ªßa tr∆∞·ªùng ph√°i Classical (Classicist)</h3>
                    <p>Tr∆∞·ªùng ph√°i n√†y s·∫Ω d√πng m·ªôt `Ledger` <strong>th·∫≠t</strong> (ho·∫∑c m·ªôt phi√™n b·∫£n `Fake` ch·∫°y trong b·ªô nh·ªõ) v√† ki·ªÉm tra k·∫øt qu·∫£ cu·ªëi c√πng.</p>
<pre><code class="language-python">from a_service import AccountService, Ledger

def test_transfer_updates_balances_correctly_CLASSICAL():
    # Arrange
    ledger = Ledger() # D√πng dependency th·∫≠t
    service = AccountService(ledger=ledger)

    # Gi·∫£ s·ª≠ ch√∫ng ta c√≥ th·ªÉ ki·ªÉm tra tr·∫°ng th√°i c·ªßa Ledger
    # (trong th·ª±c t·∫ø c√≥ th·ªÉ l√† ki·ªÉm tra DB ho·∫∑c m·ªôt Fake object)
    # ledger.set_balance("A", 200)
    # ledger.set_balance("B", 50)

    # Act
    service.transfer("A", "B", 100)

    # Assert (Ki·ªÉm tra tr·∫°ng th√°i - State)
    # assert ledger.get_balance("A") == 100
    # assert ledger.get_balance("B") == 150
    # (V√≠ d·ª• n√†y ch·ªâ in ra, n√™n kh√¥ng assert ƒë∆∞·ª£c, nh∆∞ng √Ω t∆∞·ªüng l√† v·∫≠y)
</code></pre>
                    <p><strong>∆Øu ƒëi·ªÉm:</strong> N·∫øu b·∫°n ƒë·ªïi t√™n `record_transaction` th√†nh `log_transaction`, b√†i test n√†y <strong>v·∫´n pass</strong> v√¨ k·∫øt qu·∫£ cu·ªëi c√πng (s·ªë d∆∞ t√†i kho·∫£n) kh√¥ng thay ƒë·ªïi. B√†i test n√†y c√≥ kh·∫£ nƒÉng ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactoring</span> cao h∆°n nhi·ªÅu.</p>
                </div>

                <h2>L·ªùi khuy√™n: H√£y l√† m·ªôt Classicist</h2>
                <p>C·∫£ hai tr∆∞·ªùng ph√°i ƒë·ªÅu c√≥ ∆∞u v√† nh∆∞·ª£c ƒëi·ªÉm ri√™ng. Tuy nhi√™n, ƒë·ªÉ x√¢y d·ª±ng m·ªôt b·ªô test b·ªÅn v·ªØng, √≠t chi ph√≠ b·∫£o tr√¨ v√† th·ª±c s·ª± ƒë√≥ng vai tr√≤ l√† m·ªôt m·∫°ng l∆∞·ªõi an to√†n, <strong>tr∆∞·ªùng ph√°i <span class="keyword" data-keyword="classical-school">Classical</span> th∆∞·ªùng l√† l·ª±a ch·ªçn v∆∞·ª£t tr·ªôi</strong>. Vi·ªác c√°c b√†i test c√≥ kh·∫£ nƒÉng ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactoring</span> l√† m·ªôt trong nh·ªØng y·∫øu t·ªë quan tr·ªçng nh·∫•t c·ªßa m·ªôt b·ªô test t·ªët.</p>
                <blockquote>
                    <p><strong>Quan tr·ªçng:</strong> H√£y ch·ªçn m·ªôt phong c√°ch nh·∫•t qu√°n cho to√†n b·ªô ƒë·ªôi nh√≥m v√† tu√¢n th·ªß n√≥. Vi·ªác tr·ªôn l·∫´n hai phong c√°ch n√†y trong c√πng m·ªôt codebase c√≥ th·ªÉ d·∫´n ƒë·∫øn nh·ªØng cu·ªôc tranh c√£i kh√¥ng c·∫ßn thi·∫øt v√† l√†m cho b·ªô test tr·ªü n√™n kh√≥ hi·ªÉu.</p>
                </blockquote>
            </section>

            <section id="test-data-patterns" class="content-section">
                <h1>C√°c m·∫´u (Patterns) x·ª≠ l√Ω d·ªØ li·ªáu Test</h1>
                <p>Khi vi·∫øt <span class="keyword" data-keyword="unit-test">unit test</span>, ph·∫ßn <code>Arrange</code> (chu·∫©n b·ªã d·ªØ li·ªáu) th∆∞·ªùng l√† ph·∫ßn d√†i d√≤ng v√† l·∫∑p ƒëi l·∫∑p l·∫°i nh·∫•t. N·∫øu kh√¥ng ƒë∆∞·ª£c qu·∫£n l√Ω t·ªët, n√≥ c√≥ th·ªÉ l√†m cho c√°c b√†i test tr·ªü n√™n kh√≥ ƒë·ªçc v√† kh√≥ b·∫£o tr√¨. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë m·∫´u thi·∫øt k·∫ø ph·ªï bi·∫øn gi√∫p b·∫°n gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y.</p>

                <h2>V·∫•n ƒë·ªÅ: Ph·∫ßn <code>Arrange</code> qu√° d√†i</h2>
                <p>H√£y xem x√©t m·ªôt v√≠ d·ª• v·ªõi c√°c model <code>Customer</code>, <code>Order</code>, <code>Item</code>.</p>
<pre><code class="language-python"># models.py
class Item:
    def __init__(self, name: str, price: float):
        self.name = name
        self.price = price

class Customer:
    def __init__(self, first_name: str, is_vip: bool = False):
        self.first_name = first_name
        self.is_vip = is_vip

class Order:
    def __init__(self, customer: Customer):
        self.customer = customer
        self.items = []

    def add_item(self, item: Item):
        self.items.append(item)

    @property
    def total(self) -> float:
        return sum(i.price for i in self.items)

    def apply_discount(self):
        if self.customer.is_vip:
            # VIP: 10% off
            total = self.total
            return round(total * 0.9, 2)
        return round(self.total, 2)
</code></pre>
                <p>M·ªôt b√†i test th√¥ng th∆∞·ªùng c√≥ th·ªÉ tr√¥ng nh∆∞ th·∫ø n√†y:</p>
<pre><code class="language-python"># test_standard.py
from models import Item, Customer, Order

def test_order_total_with_discount_standard():
    # ARRANGE (r·∫•t nhi·ªÅu chi ti·∫øt, kh√¥ng ph·∫£i t·∫•t c·∫£ ƒë·ªÅu quan tr·ªçng)
    customer = Customer(first_name="Hoang", is_vip=True)
    order = Order(customer)
    order.add_item(Item("Laptop", 1000))
    order.add_item(Item("Mouse", 50))

    # ACT
    discounted_price = order.apply_discount()

    # ASSERT
    assert discounted_price == 945.0
</code></pre>
                <p>Trong b√†i test tr√™n, c√°c chi ti·∫øt nh∆∞ <code>"Hoang"</code>, <code>"Laptop"</code>, <code>"Mouse"</code> kh√¥ng th·ª±c s·ª± quan tr·ªçng ƒë·ªëi v·ªõi logic c·∫ßn test (logic gi·∫£m gi√° cho kh√°ch VIP). Ch√∫ng l√†m cho b√†i test b·ªã "nhi·ªÖu".</p>

                <h2>M·∫´u 1: Object Mother</h2>
                <p><strong>√ù t∆∞·ªüng:</strong> T·∫°o m·ªôt class "M·∫π" ch·ª©a c√°c ph∆∞∆°ng th·ª©c <code>static</code> ƒë·ªÉ t·∫°o ra c√°c phi√™n b·∫£n ph·ªï bi·∫øn c·ªßa m·ªôt ƒë·ªëi t∆∞·ª£ng.</p>
<pre><code class="language-python"># test_object_mother.py
from models import Item, Order

class CustomerMother:
    @staticmethod
    def vip():
        from models import Customer
        return Customer(first_name="VIP Customer", is_vip=True)

    @staticmethod
    def regular():
        from models import Customer
        return Customer(first_name="Regular Customer", is_vip=False)

def test_order_total_with_object_mother():
    # ARRANGE (g·ªçn g√†ng h∆°n, che gi·∫•u chi ti·∫øt kh√¥ng c·∫ßn thi·∫øt)
    customer = CustomerMother.vip()
    order = Order(customer)
    order.add_item(Item("Laptop", 1000))

    # ACT
    discounted_price = order.apply_discount()

    # ASSERT
    assert discounted_price == 900.0
</code></pre>
                <ul>
                    <li><strong>∆Øu ƒëi·ªÉm:</strong> Nhanh, g·ªçn, d·ªÖ s·ª≠ d·ª•ng cho c√°c tr∆∞·ªùng h·ª£p ph·ªï bi·∫øn.</li>
                    <li><strong>Nh∆∞·ª£c ƒëi·ªÉm:</strong> K√©m linh ho·∫°t. N·∫øu b·∫°n c·∫ßn m·ªôt kh√°ch h√†ng VIP nh∆∞ng c√≥ t√™n kh√°c, b·∫°n s·∫Ω ph·∫£i th√™m m·ªôt ph∆∞∆°ng th·ª©c m·ªõi ho·∫∑c s·ª≠a ƒë·ªïi ƒë·ªëi t∆∞·ª£ng sau khi t·∫°o.</li>
                </ul>

                <h2>M·∫´u 2: Test Data Builder</h2>
                <p><strong>√ù t∆∞·ªüng:</strong> T·∫°o m·ªôt class <code>Builder</code> v·ªõi m·ªôt <span class="keyword" data-keyword="api">API</span> linh ho·∫°t (fluent interface) cho ph√©p b·∫°n t√πy ch·ªânh c√°c thu·ªôc t√≠nh c·ªßa ƒë·ªëi t∆∞·ª£ng m·ªôt c√°ch d·ªÖ d√†ng.</p>
<pre><code class="language-python"># test_builder.py
from models import Item, Order

class CustomerBuilder:
    def __init__(self):
        self._first_name = "Default Name"
        self._is_vip = False

    def with_vip(self, is_vip: bool):
        self._is_vip = is_vip
        return self

    def with_name(self, name: str):
        self._first_name = name
        return self

    def build(self):
        from models import Customer
        return Customer(first_name=self._first_name, is_vip=self._is_vip)

def test_order_with_builder():
    # ARRANGE (linh ho·∫°t v√† r·∫•t d·ªÖ ƒë·ªçc)
    customer = CustomerBuilder().with_vip(True).with_name("An").build()
    order = Order(customer)
    order.add_item(Item("Pen", 10))

    # ACT
    discounted_price = order.apply_discount()

    # ASSERT
    assert discounted_price == 9.0
</code></pre>
                <ul>
                    <li><strong>∆Øu ƒëi·ªÉm:</strong> R·∫•t linh ho·∫°t, d·ªÖ ƒë·ªçc, th·ªÉ hi·ªán r√µ √Ω ƒë·ªãnh c·ªßa b√†i test (ch·ªâ nh·ªØng thu·ªôc t√≠nh ƒë∆∞·ª£c t√πy ch·ªânh m·ªõi quan tr·ªçng).</li>
                    <li><strong>Nh∆∞·ª£c ƒëi·ªÉm:</strong> C·∫ßn vi·∫øt nhi·ªÅu code h∆°n m·ªôt ch√∫t ƒë·ªÉ t·∫°o builder.</li>
                </ul>

                <h2>Khi n√†o n√™n d√πng m·∫´u n√†o?</h2>
                <ul>
                    <li><strong>Object Mother:</strong> Ph√π h·ª£p cho c√°c ƒë·ªëi t∆∞·ª£ng ƒë∆°n gi·∫£n, c√≥ √≠t bi·∫øn th·ªÉ v√† ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i.</li>
                    <li><strong>Test Data Builder:</strong> L√† l·ª±a ch·ªçn t·ªët nh·∫•t cho c√°c ƒë·ªëi t∆∞·ª£ng ph·ª©c t·∫°p ho·∫∑c khi b·∫°n c·∫ßn nhi·ªÅu bi·∫øn th·ªÉ kh√°c nhau trong c√°c b√†i test. ƒê√¢y th∆∞·ªùng l√† m·∫´u ƒë∆∞·ª£c ∆∞u ti√™n trong c√°c d·ª± √°n l·ªõn.</li>
                </ul>
            </section>

            <section id="four-pillars" class="content-section">
                <h1>B·ªën tr·ª• c·ªôt c·ªßa m·ªôt Unit Test t·ªët</h1>
                <p>ƒê·ªÉ m·ªôt b√†i test th·ª±c s·ª± c√≥ gi√° tr·ªã, n√≥ kh√¥ng ch·ªâ c·∫ßn t√¨m ra l·ªói. M·ªôt b√†i test t·ªët ph·∫£i c√¢n b·∫±ng gi·ªØa vi·ªác ph√°t hi·ªán l·ªói v√† chi ph√≠ b·∫£o tr√¨ n√≥. T√°c gi·∫£ Vladimir Khorikov ƒë√£ ƒë·ªãnh nghƒ©a m·ªôt h·ªá th·ªëng g·ªìm b·ªën tr·ª• c·ªôt ƒë·ªÉ ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng c·ªßa m·ªôt <span class="keyword" data-keyword="unit-test">unit test</span>.</p>
                <p>M·ªôt b√†i test t·ªët ph·∫£i ƒë·ª©ng v·ªØng tr√™n c·∫£ b·ªën tr·ª• c·ªôt n√†y:</p>
                <ol>
                    <li><strong>Protection against <span class="keyword" data-keyword="regression">regressions</span> (B·∫£o v·ªá kh·ªèi l·ªói h·ªìi quy)</strong></li>
                    <li><strong>Resistance to <span class="keyword" data-keyword="refactor">refactoring</span> (Ch·ªëng ch·ªãu ƒë∆∞·ª£c t√°i c·∫•u tr√∫c)</strong></li>
                    <li><strong>Fast feedback (Ph·∫£n h·ªìi nhanh)</strong></li>
                    <li><strong>Maintainability (D·ªÖ b·∫£o tr√¨)</strong></li>
                </ol>
                <hr>
                <h2>Tr·ª• c·ªôt 1: B·∫£o v·ªá kh·ªèi l·ªói h·ªìi quy</h2>
                <p>ƒê√¢y l√† m·ª•c ƒë√≠ch c∆° b·∫£n nh·∫•t c·ªßa m·ªçi b√†i test. M·ªôt b√†i test c√≥ gi√° tr·ªã cao khi n√≥ c√≥ kh·∫£ nƒÉng ph√°t hi·ªán l·ªói trong nh·ªØng ph·∫ßn code quan tr·ªçng.</p>
                <ul>
                    <li><strong>L·ªói h·ªìi quy (<span class="keyword" data-keyword="regression">Regression</span>) l√† g√¨?</strong> L√† khi m·ªôt t√≠nh nƒÉng ƒëang ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng b·ªóng d∆∞ng b·ªã h·ªèng sau khi b·∫°n thay ƒë·ªïi code ·ªü m·ªôt n∆°i kh√°c.</li>
                    <li><strong>L√†m sao ƒë·ªÉ m·ªôt b√†i test c√≥ kh·∫£ nƒÉng b·∫£o v·ªá t·ªët?</strong>
                        <ul>
                            <li><strong>Th·ª±c thi nhi·ªÅu code:</strong> B√†i test ch·∫°y qua c√†ng nhi·ªÅu logic nghi·ªáp v·ª• th√¨ kh·∫£ nƒÉng ph√°t hi·ªán l·ªói c√†ng cao.</li>
                            <li><strong>Ki·ªÉm tra code ph·ª©c t·∫°p:</strong> Test m·ªôt thu·∫≠t to√°n ph·ª©c t·∫°p c√≥ gi√° tr·ªã h∆°n l√† test m·ªôt h√†m getter/setter ƒë∆°n gi·∫£n.</li>
                            <li><strong>T·∫≠p trung v√†o nghi·ªáp v·ª• c·ªët l√µi:</strong> Test c√°c logic quan tr·ªçng nh∆∞ thanh to√°n, ph√¢n quy·ªÅn s·∫Ω c√≥ gi√° tr·ªã cao h∆°n.</li>
                            <li><strong>Ki·ªÉm tra c√°c tr∆∞·ªùng h·ª£p bi√™n (edge cases):</strong> Test v·ªõi d·ªØ li·ªáu ƒë·∫ßu v√†o l√† r·ªóng, null, s·ªë √¢m, s·ªë 0...</li>
                        </ul>
                    </li>
                </ul>
                <div class="example-box">
                    <p><strong>V√≠ d·ª• th·ª±c t·∫ø:</strong> X√©t h√†m `calculate_total` cho gi·ªè h√†ng. Ban ƒë·∫ßu, n√≥ ch·ªâ c·ªông gi√° s·∫£n ph·∫©m. B√†i test x√°c nh·∫≠n `add(100, 50)` tr·∫£ v·ªÅ `150`. Sau ƒë√≥, m·ªôt l·∫≠p tr√¨nh vi√™n th√™m logic gi·∫£m gi√° 10% nh∆∞ng v√¥ t√¨nh √°p d·ª•ng hai l·∫ßn. B√†i test c≈©, gi·ªù ƒë√≥ng vai tr√≤ l√† test h·ªìi quy, s·∫Ω th·∫•t b·∫°i v√¨ k·∫øt qu·∫£ kh√¥ng c√≤n l√† `135` (ƒë√∫ng) m√† l√† `121.5` (sai). B√†i test ƒë√£ b·∫£o v·ªá b·∫°n kh·ªèi m·ªôt l·ªói nghi√™m tr·ªçng.</p>
                </div>
                <div class="pitfall-box">
                    <p><strong>C·∫°m b·∫´y th∆∞·ªùng g·∫∑p:</strong></p>
                    <ul>
                        <li><strong>Test code t·∫ßm th∆∞·ªùng (trivial code):</strong> Vi·∫øt test cho c√°c h√†m getter/setter ƒë∆°n gi·∫£n ch·ªâ l√†m tƒÉng coverage nh∆∞ng kh√¥ng mang l·∫°i gi√° tr·ªã b·∫£o v·ªá.</li>
                        <li><strong>Ch·ªâ test "happy path":</strong> B·ªè qua c√°c k·ªãch b·∫£n l·ªói (v√≠ d·ª•: ng∆∞·ªùi d√πng nh·∫≠p sai, API tr·∫£ v·ªÅ l·ªói) khi·∫øn nhi·ªÅu l·ªói ti·ªÅm ·∫©n kh√¥ng ƒë∆∞·ª£c ph√°t hi·ªán.</li>
                    </ul>
                </div>
                <hr>
                <h2>Tr·ª• c·ªôt 2: Ch·ªëng ch·ªãu ƒë∆∞·ª£c t√°i c·∫•u tr√∫c</h2>
                <p>ƒê√¢y l√† tr·ª• c·ªôt quan tr·ªçng nh·∫•t v√† th∆∞·ªùng b·ªã b·ªè qua nh·∫•t. N√≥ quy·∫øt ƒë·ªãnh chi ph√≠ b·∫£o tr√¨ c·ªßa b·ªô test v√† s·ª± t·ª± tin c·ªßa ƒë·ªôi ng≈© khi thay ƒë·ªïi code.</p>
                <ul>
                    <li><strong>T√°i c·∫•u tr√∫c (<span class="keyword" data-keyword="refactor">Refactoring</span>) l√† g√¨?</strong> L√† vi·ªác thay ƒë·ªïi c·∫•u tr√∫c code b√™n trong (v√≠ d·ª•: t·ªëi ∆∞u thu·∫≠t to√°n, ƒë·ªïi t√™n bi·∫øn) m√† <strong>kh√¥ng l√†m thay ƒë·ªïi <span class="keyword" data-keyword="observable-behavior">h√†nh vi c√≥ th·ªÉ quan s√°t ƒë∆∞·ª£c b√™n ngo√†i</span></strong>.</li>
                    <li><strong>B√°o ƒë·ªông gi·∫£ (<span class="keyword" data-keyword="false-positive">False Positive</span>):</strong> N·∫øu b·∫°n <span class="keyword" data-keyword="refactor">t√°i c·∫•u tr√∫c</span> code m√† b√†i test b·ªã "ƒë·ªè" (fail), trong khi ch·ª©c nƒÉng v·∫´n ƒë√∫ng, th√¨ b√†i test ƒë√≥ ƒë√£ t·∫°o ra m·ªôt b√°o ƒë·ªông gi·∫£. ƒê√¢y l√† k·∫ª th√π s·ªë m·ªôt c·ªßa m·ªôt b·ªô test hi·ªáu qu·∫£.</li>
                    <li><strong>T·∫°i sao b√°o ƒë·ªông gi·∫£ l·∫°i nguy hi·ªÉm?</strong>
                        <ul>
                            <li><strong>M·∫•t ni·ªÅm tin:</strong> Khi test b√°o l·ªói gi·∫£ qu√° nhi·ªÅu, l·∫≠p tr√¨nh vi√™n s·∫Ω d·∫ßn m·∫•t tin t∆∞·ªüng v√†o b·ªô test v√† b·∫Øt ƒë·∫ßu l·ªù ƒëi c√°c c·∫£nh b√°o.</li>
                            <li><strong>Ng·∫°i thay ƒë·ªïi:</strong> M·ªôt b·ªô test "mong manh" (brittle) s·∫Ω c·∫£n tr·ªü vi·ªác t√°i c·∫•u tr√∫c, khi·∫øn cho codebase ng√†y c√†ng xu·ªëng c·∫•p.</li>
                        </ul>
                    </li>
                    <li><strong>L√†m sao ƒë·ªÉ test ch·ªëng ch·ªãu ƒë∆∞·ª£c t√°i c·∫•u tr√∫c?</strong> H√£y ki·ªÉm tra <strong>"C√°i g√¨" (What - k·∫øt qu·∫£ cu·ªëi c√πng)</strong> thay v√¨ <strong>"L√†m th·∫ø n√†o" (How - c√°c b∆∞·ªõc th·ª±c hi·ªán b√™n trong)</strong>.</li>
                </ul>
                <div class="example-box">
                    <p><strong>V√≠ d·ª• th·ª±c t·∫ø:</strong> M·ªôt class `Authenticator` c√≥ h√†m `login(user, pass)`. B√™n trong, n√≥ g·ªçi hai h√†m private l√† `_checkPassword()` v√† `_generateToken()`.
                    <br> - <strong>Test mong manh (Sai):</strong> Mock v√† x√°c minh r·∫±ng `_checkPassword` v√† `_generateToken` ƒë∆∞·ª£c g·ªçi.
                    <br> - <strong>Test b·ªÅn v·ªØng (ƒê√∫ng):</strong> G·ªçi `login("correct", "pass")` v√† x√°c minh r·∫±ng k·∫øt qu·∫£ tr·∫£ v·ªÅ l√† m·ªôt token h·ª£p l·ªá.
                    <br>Khi b·∫°n <span class="keyword" data-keyword="refactor">refactor</span> b·∫±ng c√°ch g·ªôp hai h√†m private th√†nh m·ªôt, test mong manh s·∫Ω h·ªèng (b√°o ƒë·ªông gi·∫£), c√≤n test b·ªÅn v·ªØng v·∫´n pass v√¨ h√†nh vi cu·ªëi c√πng kh√¥ng ƒë·ªïi.</p>
                </div>
                <div class="pitfall-box">
                    <p><strong>C·∫°m b·∫´y th∆∞·ªùng g·∫∑p:</strong></p>
                    <ul>
                        <li><strong>Mocking qu√° nhi·ªÅu:</strong> Mock c√°c class n·ªôi b·ªô (kh√¥ng ph·∫£i dependency ngo√†i) s·∫Ω khi·∫øn test b·ªã g·∫Øn ch·∫∑t v√†o c·∫•u tr√∫c hi·ªán t·∫°i.</li>
                        <li><strong>Ki·ªÉm tra private state:</strong> C·ªë g·∫Øng truy c·∫≠p v√† ki·ªÉm tra c√°c thu·ªôc t√≠nh/ph∆∞∆°ng th·ª©c private l√† m·ªôt d·∫•u hi·ªáu r√µ r√†ng c·ªßa test mong manh.</li>
                    </ul>
                </div>
                <hr>
                <h2>Tr·ª• c·ªôt 3: Ph·∫£n h·ªìi nhanh</h2>
                <p>T·ªëc ƒë·ªô l√† y·∫øu t·ªë quy·∫øt ƒë·ªãnh t·∫ßn su·∫•t b·∫°n ch·∫°y b·ªô test. M·ªôt b·ªô test ch·∫≠m s·∫Ω kh√¥ng ƒë∆∞·ª£c ch·∫°y th∆∞·ªùng xuy√™n, l√†m m·∫•t ƒëi l·ª£i √≠ch l·ªõn nh·∫•t c·ªßa n√≥.</p>
                <ul>
                    <li><strong>V√≤ng l·∫∑p ph·∫£n h·ªìi (Feedback Loop):</strong> Test c√†ng nhanh, b·∫°n c√†ng c√≥ th·ªÉ ch·∫°y ch√∫ng th∆∞·ªùng xuy√™n h∆°n (v√≠ d·ª•: sau m·ªói l·∫ßn l∆∞u file). ƒêi·ªÅu n√†y gi√∫p b·∫°n ph√°t hi·ªán l·ªói ngay khi n√≥ v·ª´a ƒë∆∞·ª£c t·∫°o ra, l√†m cho vi·ªác s·ª≠a l·ªói tr·ªü n√™n d·ªÖ d√†ng v√† √≠t t·ªën k√©m h∆°n r·∫•t nhi·ªÅu.</li>
                    <li><strong>Ph√¢n bi·ªát <span class="keyword" data-keyword="unit-test">Unit Test</span> v√† <span class="keyword" data-keyword="integration-test">Integration Test</span>:</strong> ƒê√¢y ch√≠nh l√† y·∫øu t·ªë kh√°c bi·ªát l·ªõn nh·∫•t. <span class="keyword" data-keyword="unit-test">Unit test</span> ph·∫£i ch·∫°y trong v√†i mili gi√¢y, trong khi <span class="keyword" data-keyword="integration-test">integration test</span> (li√™n quan ƒë·∫øn network, DB, file system) c√≥ th·ªÉ m·∫•t v√†i gi√¢y ho·∫∑c h∆°n.</li>
                </ul>
                <div class="pitfall-box">
                    <p><strong>C·∫°m b·∫´y th∆∞·ªùng g·∫∑p:</strong></p>
                    <ul>
                        <li><strong>D√πng `sleep()` trong test:</strong> C·ªë g·∫Øng ch·ªù m·ªôt t√°c v·ª• b·∫•t ƒë·ªìng b·ªô b·∫±ng c√°ch "ng·ªß" l√† m·ªôt c√°ch l√†m kh√¥ng ·ªïn ƒë·ªãnh v√† l√†m ch·∫≠m test. H√£y d√πng c√°c c∆° ch·∫ø testing b·∫•t ƒë·ªìng b·ªô chuy√™n d·ª•ng.</li>
                        <li><strong>ƒê·ªÉ <span class="keyword" data-keyword="unit-test">unit test</span> th·ª±c hi·ªán I/O:</strong> M·ªôt <span class="keyword" data-keyword="unit-test">unit test</span> th·ª±c s·ª± kh√¥ng bao gi·ªù ƒë∆∞·ª£c ph√©p truy c·∫≠p network, <span class="keyword" data-keyword="database">database</span>, hay file system.</li>
                    </ul>
                </div>
                <hr>
                <h2>Tr·ª• c·ªôt 4: D·ªÖ b·∫£o tr√¨</h2>
                <p>Code test c≈©ng quan tr·ªçng nh∆∞ code s·∫£n ph·∫©m v√† c·∫ßn ƒë∆∞·ª£c chƒÉm s√≥c c·∫©n th·∫≠n. M·ªôt b√†i test kh√≥ ƒë·ªçc, kh√≥ ch·∫°y s·∫Ω nhanh ch√≥ng tr·ªü th√†nh g√°nh n·∫∑ng.</p>
                <ul>
                    <li><strong>ƒê·ªô kh√≥ hi·ªÉu:</strong>
                        <ul>
                            <li><strong>Ng·∫Øn g·ªçn & T·∫≠p trung:</strong> M·ªôt b√†i test n√™n ng·∫Øn g·ªçn v√† ch·ªâ ki·ªÉm tra m·ªôt k·ªãch b·∫£n duy nh·∫•t (single concern).</li>
                            <li><strong>D·ªÖ ƒë·ªçc:</strong> S·ª≠ d·ª•ng c√°c m·∫´u nh∆∞ <span class="keyword" data-keyword="aaa">AAA</span>, ƒë·∫∑t t√™n test r√µ r√†ng ƒë·ªÉ th·ªÉ hi·ªán √Ω ƒë·ªãnh (v√≠ d·ª•: `test_Login_WithInvalidPassword_ReturnsFalse`).</li>
                        </ul>
                    </li>
                    <li><strong>ƒê·ªô kh√≥ v·∫≠n h√†nh:</strong>
                        <ul>
                            <li>M·ªôt <span class="keyword" data-keyword="unit-test">unit test</span> t·ªët ph·∫£i c√≥ th·ªÉ ch·∫°y m√† kh√¥ng c·∫ßn m·ªôt m√¥i tr∆∞·ªùng ph·ª©c t·∫°p (kh√¥ng c·∫ßn <span class="keyword" data-keyword="database">database</span>, kh√¥ng c·∫ßn server, kh√¥ng c·∫ßn file c·∫•u h√¨nh ƒë·∫∑c bi·ªát).</li>
                        </ul>
                    </li>
                </ul>
                 <div class="example-box">
                    <p><strong>V√≠ d·ª• th·ª±c t·∫ø:</strong>
                    <br> - <strong>Kh√≥ b·∫£o tr√¨:</strong> Test t√™n l√† `test1()`, kh√¥ng c√≥ comment, t·∫°o ƒë·ªëi t∆∞·ª£ng b·∫±ng `new Customer("a", "b", "c", 1, 2, 3, true)`. R·∫•t kh√≥ ƒë·ªÉ bi·∫øt m·ª•c ƒë√≠ch c·ªßa test v√† √Ω nghƒ©a c·ªßa c√°c tham s·ªë.
                    <br> - <strong>D·ªÖ b·∫£o tr√¨:</strong> Test t√™n l√† `test_VipCustomer_Gets_PriorityShipping()`. D·ªØ li·ªáu ƒë∆∞·ª£c t·∫°o b·∫±ng Test Data Builder: `customer = new CustomerBuilder().isVip().build()`. √ù ƒë·ªãnh c·ªßa b√†i test tr·ªü n√™n c·ª±c k·ª≥ r√µ r√†ng.</p>
                </div>
                 <div class="pitfall-box">
                    <p><strong>C·∫°m b·∫´y th∆∞·ªùng g·∫∑p:</strong></p>
                    <ul>
                        <li><strong>Logic trong test:</strong> M·ªôt b√†i test kh√¥ng n√™n ch·ª©a c√°c v√≤ng l·∫∑p, c√¢u l·ªánh `if/else`. N·∫øu b·∫°n c·∫ßn logic, h√£y ƒë∆∞a n√≥ ra m·ªôt h√†m helper.</li>
                        <li><strong>Magic strings/numbers:</strong> S·ª≠ d·ª•ng c√°c h·∫±ng s·ªë c√≥ t√™n r√µ r√†ng thay v√¨ c√°c gi√° tr·ªã "ma thu·∫≠t" kh√¥ng r√µ √Ω nghƒ©a.</li>
                    </ul>
                </div>
                <hr>
                <h2>S·ª± ƒë√°nh ƒë·ªïi</h2>
                <p>Kh√¥ng th·ªÉ c√≥ m·ªôt b√†i test ho√†n h·∫£o ƒë·∫°t ƒëi·ªÉm t·ªëi ƒëa ·ªü c·∫£ 4 tr·ª• c·ªôt. S·∫Ω lu√¥n c√≥ s·ª± ƒë√°nh ƒë·ªïi, ƒë·∫∑c bi·ªát l√† gi·ªØa <strong>Tr·ª• c·ªôt 1 (B·∫£o v·ªá)</strong> v√† <strong>Tr·ª• c·ªôt 2 (Ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactor</span>) & 3 (T·ªëc ƒë·ªô)</strong>.</p>
                <ul>
                    <li><strong><span class="keyword" data-keyword="e2e-test">E2E Test</span>:</strong> B·∫£o v·ªá t·ªët nh·∫•t, ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactor</span> t·ªët, nh∆∞ng ph·∫£n h·ªìi c·ª±c k·ª≥ ch·∫≠m v√† kh√≥ b·∫£o tr√¨.</li>
                    <li><strong><span class="keyword" data-keyword="unit-test">Unit Test</span> mong manh:</strong> B·∫£o v·ªá t·ªët, ph·∫£n h·ªìi nhanh, nh∆∞ng ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactor</span> c·ª±c t·ªá (chi ph√≠ b·∫£o tr√¨ cao).</li>
                    <li><strong><span class="keyword" data-keyword="unit-test">Unit Test</span> t·ªët:</strong> C√¢n b·∫±ng gi·ªØa c·∫£ b·ªën y·∫øu t·ªë, trong ƒë√≥ <strong>kh·∫£ nƒÉng ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactor</span> v√† d·ªÖ b·∫£o tr√¨ l√† kh√¥ng th·ªÉ nh√¢n nh∆∞·ª£ng</strong>.</li>
                </ul>
            </section>

            <section id="behavior-vs-implementation" class="content-section">
                <h1>Behavior vs. Implementation Details</h1>
                <p>ƒê·ªÉ vi·∫øt ƒë∆∞·ª£c nh·ªØng b√†i test c√≥ kh·∫£ nƒÉng ch·ªëng ch·ªãu t√°i c·∫•u tr√∫c (resistant to <span class="keyword" data-keyword="refactor">refactoring</span>), b·∫°n bu·ªôc ph·∫£i hi·ªÉu r√µ v√† ph√¢n bi·ªát ƒë∆∞·ª£c ƒë√¢u l√† <strong><span class="keyword" data-keyword="observable-behavior">h√†nh vi quan s√°t ƒë∆∞·ª£c</span></strong> v√† ƒë√¢u l√† <strong><span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span></strong>.</p>
                <ul>
                    <li><strong>Ki·ªÉm tra <span class="keyword" data-keyword="observable-behavior">h√†nh vi quan s√°t ƒë∆∞·ª£c</span>:</strong> Gi√∫p b√†i test c·ªßa b·∫°n tr·ªü n√™n b·ªÅn v·ªØng. ‚úÖ</li>
                    <li><strong>Ki·ªÉm tra <span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span>:</strong> Khi·∫øn b√†i test c·ªßa b·∫°n tr·ªü n√™n mong manh (brittle). ‚ùå</li>
                </ul>
                <h2>ƒê·ªãnh nghƒ©a</h2>
                <p>M·ªçi ƒëo·∫°n code ƒë·ªÅu c√≥ th·ªÉ ƒë∆∞·ª£c ph√¢n lo·∫°i theo hai g√≥c nh√¨n:</p>
                <ol>
                    <li><strong>G√≥c nh√¨n C√¥ng khai (<span class="keyword" data-keyword="public-api">Public</span> vs. <span class="keyword" data-keyword="private-api">Private</span>):</strong>
                        <ul>
                            <li><strong><span class="keyword" data-keyword="public-api">Public API</span>:</strong> C√°c ph∆∞∆°ng th·ª©c v√† thu·ªôc t√≠nh m√† code b√™n ngo√†i (client) ƒë∆∞·ª£c ph√©p truy c·∫≠p v√† s·ª≠ d·ª•ng.</li>
                            <li><strong><span class="keyword" data-keyword="private-api">Private API</span>:</strong> C√°c ph∆∞∆°ng th·ª©c v√† thu·ªôc t√≠nh c·ªßa m·ªôt class ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong n·ªôi b·ªô v√† kh√¥ng d√†nh cho b√™n ngo√†i truy c·∫≠p.</li>
                        </ul>
                    </li>
                    <li><strong>G√≥c nh√¨n M·ª•c ƒë√≠ch (Behavior vs. Implementation):</strong>
                        <ul>
                            <li><strong><span class="keyword" data-keyword="observable-behavior">H√†nh vi quan s√°t ƒë∆∞·ª£c (Observable Behavior)</span>:</strong> L√† nh·ªØng k·∫øt qu·∫£ ho·∫∑c t√°c d·ª•ng ph·ª• (side effect) m√† client mong ƒë·ª£i khi t∆∞∆°ng t√°c v·ªõi ƒë·ªëi t∆∞·ª£ng. ƒê√¢y l√† "c√°i g√¨" (what) m√† code c·ªßa b·∫°n l√†m.</li>
                            <li><strong><span class="keyword" data-keyword="implementation-details">Chi ti·∫øt c√†i ƒë·∫∑t (Implementation Details)</span>:</strong> L√† c√°c b∆∞·ªõc, thu·∫≠t to√°n, ho·∫∑c c·∫•u tr√∫c d·ªØ li·ªáu n·ªôi b·ªô ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ra h√†nh vi ƒë√≥. ƒê√¢y l√† "l√†m th·∫ø n√†o" (how) m√† code c·ªßa b·∫°n th·ª±c hi·ªán c√¥ng vi·ªác.</li>
                        </ul>
                    </li>
                </ol>
                <h3>M·ªëi quan h·ªá</h3>
                <p>M·ªôt <span class="keyword" data-keyword="api">API</span> ƒë∆∞·ª£c thi·∫øt k·∫ø t·ªët (well-designed) l√† khi <strong><span class="keyword" data-keyword="public-api">Public API</span> v√† <span class="keyword" data-keyword="observable-behavior">Observable Behavior</span> l√† m·ªôt</strong>. T·∫•t c·∫£ c√°c <span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span> ph·∫£i ƒë∆∞·ª£c che gi·∫•u (<span class="keyword" data-keyword="encapsulation">encapsulated</span>) v√† l√† <code>private</code>.</p>
                <img src="images/api_design.svg" alt="Well-designed API vs. Leaking API">
                <p>Khi m·ªôt <span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span> b·ªã "r√≤ r·ªâ" (leak) ra <span class="keyword" data-keyword="public-api">Public API</span>, n√≥ s·∫Ω c√°m d·ªó b·∫°n vi·∫øt nh·ªØng b√†i test ki·ªÉm tra v√†o ƒë√≥, v√† ƒë√≥ l√† ngu·ªìn g·ªëc c·ªßa c√°c b√†i test mong manh.</p>

                <h2>V√≠ d·ª•: R√≤ r·ªâ Logic t√≠nh to√°n</h2>
                <p>H√£y xem x√©t m·ªôt class `Order` c·∫ßn t√≠nh t·ªïng ti·ªÅn, bao g·ªìm c·∫£ thu·∫ø.</p>
                <h3>üî¥ C√°ch l√†m sai (R√≤ r·ªâ chi ti·∫øt c√†i ƒë·∫∑t)</h3>
                <p>Class `Order` ƒë·ªÉ l·ªô c√°c ph∆∞∆°ng th·ª©c t√≠nh to√°n trung gian. Client ph·∫£i bi·∫øt c√°c b∆∞·ªõc ƒë·ªÉ c√≥ ƒë∆∞·ª£c k·∫øt qu·∫£ cu·ªëi c√πng.</p>
<pre><code class="language-python"># BAD CODE: R√≤ r·ªâ "l√†m th·∫ø n√†o"
class Order:
    def __init__(self, price, quantity):
        self.price = price
        self.quantity = quantity

    # Chi ti·∫øt c√†i ƒë·∫∑t 1, b·ªã ƒë·ªÉ public
    def get_subtotal(self):
        return self.price * self.quantity

    # Chi ti·∫øt c√†i ƒë·∫∑t 2, b·ªã ƒë·ªÉ public
    def get_tax(self, subtotal):
        return subtotal * 0.1 # 10% tax

# Client code (ho·∫∑c test code)
order = Order(price=100, quantity=2)
subtotal = order.get_subtotal()
tax = order.get_tax(subtotal)
total = subtotal + tax
# ==> Client ph·∫£i bi·∫øt qu√° nhi·ªÅu!
</code></pre>
                <p><strong>V·∫•n ƒë·ªÅ v·ªõi test:</strong> M·ªôt b√†i test cho `Order` c√≥ th·ªÉ s·∫Ω mock v√† ki·ªÉm tra `get_subtotal` v√† `get_tax` ƒë∆∞·ª£c g·ªçi. N·∫øu sau n√†y b·∫°n <span class="keyword" data-keyword="refactor">refactor</span> `Order` ƒë·ªÉ t√≠nh thu·∫ø theo m·ªôt c√°ch kh√°c (v√≠ d·ª•: g·ªôp 2 h√†m th√†nh 1), b√†i test s·∫Ω h·ªèng d√π k·∫øt qu·∫£ cu·ªëi c√πng v·∫´n ƒë√∫ng.</p>

                <h3>üü¢ C√°ch l√†m ƒë√∫ng (Che gi·∫•u chi ti·∫øt c√†i ƒë·∫∑t)</h3>
                <p>Class `Order` ch·ªâ cung c·∫•p m·ªôt ph∆∞∆°ng th·ª©c `public` duy nh·∫•t l√† `get_total`, th·ªÉ hi·ªán h√†nh vi m√† client quan t√¢m.</p>
<pre><code class="language-python"># GOOD CODE: Che gi·∫•u "l√†m th·∫ø n√†o"
class Order:
    def __init__(self, price, quantity):
        self._price = price
        self._quantity = quantity

    # --- H√†nh vi quan s√°t ƒë∆∞·ª£c ---
    def get_total(self):
        subtotal = self._get_subtotal()
        tax = self._get_tax(subtotal)
        return subtotal + tax

    # --- Chi ti·∫øt c√†i ƒë·∫∑t ---
    def _get_subtotal(self):
        return self._price * self._quantity

    def _get_tax(self, subtotal):
        return subtotal * 0.1

# Client code (ho·∫∑c test code)
order = Order(price=100, quantity=2)
total = order.get_total() # ==> Client ch·ªâ c·∫ßn bi·∫øt "c√°i g√¨"
assert total == 220
</code></pre>
                <p><strong>L·ª£i √≠ch:</strong> B√¢y gi·ªù b·∫°n c√≥ th·ªÉ t·ª± do thay ƒë·ªïi c√°c h√†m `private` (`_get_subtotal`, `_get_tax`) m√† kh√¥ng l√†m h·ªèng b·∫•t k·ª≥ client code hay b√†i test n√†o, mi·ªÖn l√† `get_total()` v·∫´n tr·∫£ v·ªÅ k·∫øt qu·∫£ ƒë√∫ng.</p>

                <h2>Nguy√™n l√Ω Tell, Don't Ask</h2>
                <p>Nguy√™n l√Ω n√†y l√† kim ch·ªâ nam gi√∫p b·∫°n thi·∫øt k·∫ø <span class="keyword" data-keyword="api">API</span> t·ªët v√† tr√°nh r√≤ r·ªâ chi ti·∫øt c√†i ƒë·∫∑t. N√≥ ƒë·∫∑c bi·ªát quan tr·ªçng khi m·ªôt h√†nh ƒë·ªông c·∫ßn thay ƒë·ªïi tr·∫°ng th√°i c·ªßa ƒë·ªëi t∆∞·ª£ng.</p>
                <ul>
                    <li><strong>Ask (H·ªèi - X·∫•u):</strong> H·ªèi m·ªôt ƒë·ªëi t∆∞·ª£ng v·ªÅ tr·∫°ng th√°i c·ªßa n√≥ (v√≠ d·ª•: `get_status()`), th·ª±c hi·ªán logic ·ªü b√™n ngo√†i, r·ªìi c·∫≠p nh·∫≠t l·∫°i tr·∫°ng th√°i cho ƒë·ªëi t∆∞·ª£ng ƒë√≥ (v√≠ d·ª•: `set_status()`).</li>
                    <li><strong>Tell (B·∫£o - T·ªët):</strong> Ra l·ªánh cho m·ªôt ƒë·ªëi t∆∞·ª£ng th·ª±c hi·ªán m·ªôt h√†nh ƒë·ªông (v√≠ d·ª•: `approve()`). ƒê·ªëi t∆∞·ª£ng s·∫Ω t·ª± s·ª≠ d·ª•ng tr·∫°ng th√°i n·ªôi b·ªô c·ªßa n√≥ ƒë·ªÉ th·ª±c hi·ªán h√†nh ƒë·ªông ƒë√≥.</li>
                </ul>
                <div class="example-box">
                    <p><strong>V√≠ d·ª•: Ph√™ duy·ªát m·ªôt t√†i li·ªáu</strong></p>
                    <p><strong>- C√°ch l√†m "Ask" (X·∫•u):</strong></p>
<pre><code class="language-python"># Client code
if document.get_status() == "PENDING":
    # Logic n·∫±m b√™n ngo√†i, client ph·∫£i bi·∫øt v·ªÅ c√°c tr·∫°ng th√°i
    document.set_status("APPROVED")
    document.set_approved_by(current_user)
    # ...
</code></pre>
                    <p><strong>- C√°ch l√†m "Tell" (T·ªët):</strong></p>
<pre><code class="language-python"># Client code
# Client ch·ªâ ra l·ªánh, kh√¥ng c·∫ßn bi·∫øt logic b√™n trong
document.approve(by_user=current_user)
</code></pre>
                </div>
                <p>B·∫±ng c√°ch tu√¢n th·ªß "Tell, Don't Ask", b·∫°n s·∫Ω t·ª± ƒë·ªông t·∫°o ra c√°c <span class="keyword" data-keyword="api">API</span> ƒë√≥ng g√≥i t·ªët, che gi·∫•u c√°c <span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span> v√† gi√∫p cho c√°c b√†i test c·ªßa b·∫°n tr·ªü n√™n b·ªÅn v·ªØng h∆°n.</p>
            </section>

            <section id="test-doubles" class="content-section">
                <h1>Mocks, Stubs v√† Test Doubles</h1>
                <p>Khi vi·∫øt <span class="keyword" data-keyword="unit-test">unit test</span>, ch√∫ng ta c·∫ßn "c√°ch ly" ƒë∆°n v·ªã ƒëang ƒë∆∞·ª£c test (<span class="keyword" data-keyword="sut">SUT - System Under Test</span>) kh·ªèi c√°c <span class="keyword" data-keyword="dependency">dependency</span> (ƒë·ªëi t∆∞·ª£ng ph·ª• thu·ªôc) c·ªßa n√≥. <strong><span class="keyword" data-keyword="test-double">Test Doubles</span></strong> l√† thu·∫≠t ng·ªØ chung ch·ªâ c√°c ƒë·ªëi t∆∞·ª£ng gi·∫£ ƒë∆∞·ª£c t·∫°o ra ƒë·ªÉ thay th·∫ø c√°c <span class="keyword" data-keyword="dependency">dependency</span> th·∫≠t trong m√¥i tr∆∞·ªùng test.</p>
                <p>M·∫∑c d√π ch√∫ng ta hay g·ªçi chung l√† "<span class="keyword" data-keyword="mock">mock</span>", nh∆∞ng c√≥ nhi·ªÅu lo·∫°i <span class="keyword" data-keyword="test-double">Test Double</span> kh√°c nhau, m·ªói lo·∫°i c√≥ m·ªôt m·ª•c ƒë√≠ch ri√™ng. Ph√¢n bi·ªát r√µ ch√∫ng l√† ch√¨a kh√≥a ƒë·ªÉ vi·∫øt c√°c b√†i test ƒë√∫ng ƒë·∫Øn v√† b·ªÅn v·ªØng.</p>

                <div class="practice-link-box">
                    <p>üí° <strong>Xem th·ª±c h√†nh:</strong> ƒê·ªÉ xem c√°ch t·∫°o Stubs v√† Mocks trong th·ª±c t·∫ø, h√£y tham kh·∫£o c√°c v√≠ d·ª• trong ph·∫ßn <a href="#" class="nav-item" data-target="pytest-hands-on">Th·ª±c h√†nh PyTest</a> v√† <a href="#" class="nav-item" data-target="gtest-hands-on">Th·ª±c h√†nh GTest</a>.</p>
                </div>

                <h2>Ph√¢n bi·ªát Stub v√† Mock</h2>
                <p>ƒê√¢y l√† hai lo·∫°i Test Double quan tr·ªçng v√† th∆∞·ªùng b·ªã nh·∫ßm l·∫´n nh·∫•t. S·ª± kh√°c bi·ªát n·∫±m ·ªü <strong>h∆∞·ªõng c·ªßa d√≤ng th√¥ng tin</strong>.</p>

                <div style="text-align: center; margin: 2em 0;">
                    <img src="images/test_doubles_flow.svg" alt="Lu·ªìng d·ªØ li·ªáu c·ªßa Stub v√† Mock" style="max-width: 80%;">
                </div>

                <h3><span class="keyword" data-keyword="stub">Stub</span> (Gi·∫£ l·∫≠p d·ªØ li·ªáu ƒë·∫ßu v√†o)</h3>
                <ul>
                    <li><strong>M·ª•c ƒë√≠ch:</strong> Cung c·∫•p d·ªØ li·ªáu ho·∫∑c tr·∫°ng th√°i gi·∫£ cho <span class="keyword" data-keyword="sut">SUT</span>. <span class="keyword" data-keyword="stub">Stub</span> tr·∫£ l·ªùi c√°c c√¢u h·ªèi (queries) t·ª´ <span class="keyword" data-keyword="sut">SUT</span>.</li>
                    <li><strong>Lu·ªìng d·ªØ li·ªáu:</strong> T·ª´ <span class="keyword" data-keyword="dependency">Dependency</span> (Stub) <strong>ƒëi v√†o</strong> <span class="keyword" data-keyword="sut">SUT</span>.</li>
                    <li><strong>Lo·∫°i Test:</strong> D√πng trong <strong>State Testing</strong>. B·∫°n cung c·∫•p tr·∫°ng th√°i ƒë·∫ßu v√†o qua <span class="keyword" data-keyword="stub">Stub</span>, v√† sau ƒë√≥ x√°c minh tr·∫°ng th√°i cu·ªëi c√πng c·ªßa <span class="keyword" data-keyword="sut">SUT</span>.</li>
                    <li><strong>Quy t·∫Øc v√†ng:</strong> <strong>ƒê·ª´ng bao gi·ªù x√°c minh (verify) m·ªôt l·ªùi g·ªçi ƒë·∫øn <span class="keyword" data-keyword="stub">Stub</span>.</strong> Vi·ªác verify <span class="keyword" data-keyword="stub">Stub</span> s·∫Ω khi·∫øn test b·ªã g·∫Øn ch·∫∑t v√†o <span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span>.</li>
                </ul>
<pre><code class="language-python">from unittest.mock import Mock

# userRepository l√† m·ªôt Stub v√¨ n√≥ cung c·∫•p d·ªØ li·ªáu cho SUT
user_repository = Mock()
user_repository.get_user_by_id.return_value = {"name": "Alice", "is_admin": True}

# SUT (v√≠ d·ª•: m·ªôt service) s·ª≠ d·ª•ng d·ªØ li·ªáu n√†y
auth_service = AuthenticationService(user_repository)
result = auth_service.can_user_access_admin_panel(user_id=123)

# Assert tr·∫°ng th√°i cu·ªëi c√πng, kh√¥ng verify l·ªùi g·ªçi ƒë·∫øn stub
assert result is True
</code></pre>

                <h3><span class="keyword" data-keyword="mock">Mock</span> (Gi·∫£ l·∫≠p h·ªá th·ªëng b√™n ngo√†i)</h3>
                <ul>
                    <li><strong>M·ª•c ƒë√≠ch:</strong> Ghi l·∫°i v√† x√°c minh c√°c l·ªánh (commands) m√† <span class="keyword" data-keyword="sut">SUT</span> g·ª≠i ra cho c√°c h·ªá th·ªëng b√™n ngo√†i.</li>
                    <li><strong>Lu·ªìng d·ªØ li·ªáu:</strong> T·ª´ <span class="keyword" data-keyword="sut">SUT</span> <strong>ƒëi ra</strong> <span class="keyword" data-keyword="dependency">Dependency</span> (Mock).</li>
                    <li><strong>Lo·∫°i Test:</strong> D√πng trong <strong>Interaction Testing</strong>. B·∫°n th·ª±c thi m·ªôt h√†nh ƒë·ªông v√† x√°c minh r·∫±ng <span class="keyword" data-keyword="sut">SUT</span> ƒë√£ g·ªçi ƒë√∫ng l·ªánh ra h·ªá th·ªëng ngo√†i.</li>
                </ul>
<pre><code class="language-python">from unittest.mock import Mock

# email_gateway l√† m·ªôt Mock v√¨ n√≥ nh·∫≠n l·ªánh t·ª´ SUT
email_gateway = Mock()

notification_service = NotificationService(email_gateway)
notification_service.notify_user_of_login(email="test@example.com")

# X√°c minh r·∫±ng SUT ƒë√£ g·ª≠i l·ªánh ƒëi ƒë√∫ng c√°ch
email_gateway.send_notification_email.assert_called_once_with("test@example.com", "Login Alert")
</code></pre>

                <h2>T√≥m t·∫Øt c√°c lo·∫°i Test Double</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Lo·∫°i</th>
                            <th>M·ª•c ƒë√≠ch ch√≠nh</th>
                            <th>Khi n√†o d√πng?</th>
                            <th>V√≠ d·ª•</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Dummy</strong></td>
                            <td>L·∫•p ƒë·∫ßy tham s·ªë, kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng.</td>
                            <td>Khi m·ªôt h√†m y√™u c·∫ßu m·ªôt ƒë·ªëi t∆∞·ª£ng nh∆∞ng logic b·∫°n test kh√¥ng d√πng ƒë·∫øn n√≥.</td>
                            <td>Truy·ªÅn `None` ho·∫∑c m·ªôt object r·ªóng.</td>
                        </tr>
                        <tr>
                            <td><strong>Stub</strong></td>
                            <td>Cung c·∫•p d·ªØ li·ªáu/tr·∫°ng th√°i cho SUT.</td>
                            <td>Khi SUT c·∫ßn l·∫•y d·ªØ li·ªáu t·ª´ m·ªôt dependency ƒë·ªÉ th·ª±c hi·ªán logic (v√≠ d·ª•: ƒë·ªçc t·ª´ DB).</td>
                            <td>M·ªôt `UserRepository` gi·∫£ tr·∫£ v·ªÅ m·ªôt User ƒë·ªãnh s·∫µn.</td>
                        </tr>
                        <tr>
                            <td><strong>Mock</strong></td>
                            <td>X√°c minh c√°c l·ªánh g·ªçi ƒëi ra t·ª´ SUT.</td>
                            <td>Khi SUT c·∫ßn thay ƒë·ªïi tr·∫°ng th√°i c·ªßa m·ªôt h·ªá th·ªëng b√™n ngo√†i (v√≠ d·ª•: g·ª≠i email).</td>
                            <td>M·ªôt `EmailGateway` gi·∫£ ƒë·ªÉ ki·ªÉm tra h√†m `send` c√≥ ƒë∆∞·ª£c g·ªçi kh√¥ng.</td>
                        </tr>
                        <tr>
                            <td><strong>Fake</strong></td>
                            <td>M·ªôt phi√™n b·∫£n c√†i ƒë·∫∑t ƒë∆°n gi·∫£n h√≥a.</td>
                            <td>Khi b·∫°n c·∫ßn m·ªôt dependency ho·∫°t ƒë·ªông g·∫ßn gi·ªëng th·∫≠t nh∆∞ng kh√¥ng mu·ªën s·ª± ph·ª©c t·∫°p (v√≠ d·ª•: I/O).</td>
                            <td>M·ªôt `InMemoryDatabase` thay th·∫ø cho PostgreSQL.</td>
                        </tr>
                         <tr>
                            <td><strong>Spy</strong></td>
                            <td>V·ª´a cung c·∫•p d·ªØ li·ªáu, v·ª´a ghi l·∫°i l·ªùi g·ªçi.</td>
                            <td>Khi m·ªôt dependency v·ª´a l√† query v·ª´a l√† command. Th∆∞·ªùng √≠t d√πng v√† c√≥ th·ªÉ l√† d·∫•u hi·ªáu c·ªßa thi·∫øt k·∫ø dependency ch∆∞a t·ªët.</td>
                            <td>M·ªôt `Cache` v·ª´a tr·∫£ v·ªÅ d·ªØ li·ªáu, v·ª´a c·∫ßn ki·ªÉm tra xem h√†m `save` c√≥ ƒë∆∞·ª£c g·ªçi kh√¥ng.</td>
                        </tr>
                    </tbody>
                </table>

                <blockquote>
                    <p><strong>L∆∞u √Ω:</strong> C√°c th∆∞ vi·ªán nh∆∞ <code>unittest.mock</code> c·ªßa Python hay <code>GMock</code> c·ªßa C++ th∆∞·ªùng cung c·∫•p m·ªôt class <code>Mock</code> ƒëa nƒÉng. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng class n√†y ƒë·ªÉ t·∫°o ra c·∫£ <span class="keyword" data-keyword="stub">Stub</span>, <span class="keyword" data-keyword="mock">Mock</span>, v√† Spy. ƒêi·ªÅu quan tr·ªçng l√† <strong>c√°ch b·∫°n s·ª≠ d·ª•ng</strong> ƒë·ªëi t∆∞·ª£ng ƒë√≥ trong b√†i test s·∫Ω quy·∫øt ƒë·ªãnh vai tr√≤ th·ª±c s·ª± c·ªßa n√≥.</p>
                </blockquote>
            </section>

            <section id="architecture-mocking" class="content-section">
                <h1>Ki·∫øn tr√∫c v√† Quy t·∫Øc Mocking</h1>
                <p>Vi·ªác quy·∫øt ƒë·ªãnh "n√™n <span class="keyword" data-keyword="mock">mock</span> c√°i g√¨" v√† "kh√¥ng n√™n <span class="keyword" data-keyword="mock">mock</span> c√°i g√¨" l√† m·ªôt trong nh·ªØng quy·∫øt ƒë·ªãnh kh√≥ khƒÉn nh·∫•t, nh∆∞ng c≈©ng quan tr·ªçng nh·∫•t, khi vi·∫øt test. M·ªôt quy t·∫Øc sai l·∫ßm c√≥ th·ªÉ d·∫´n ƒë·∫øn m·ªôt b·ªô test mong manh, kh√≥ b·∫£o tr√¨. C√¢u tr·∫£ l·ªùi n·∫±m ·ªü vi·ªác hi·ªÉu r√µ ranh gi·ªõi ki·∫øn tr√∫c c·ªßa ·ª©ng d·ª•ng.</p>

                <h2>Quy t·∫Øc v√†ng: "Don't mock what you don't own"</h2>
                <p>ƒê√¢y l√† m·ªôt nguy√™n t·∫Øc ch·ªâ ƒë·∫°o c·ª±c k·ª≥ hi·ªáu qu·∫£:</p>
                <blockquote>
                    <p>Ch·ªâ mock c√°c type (class, interface) m√† b·∫°n kh√¥ng s·ªü h·ªØu.</p>
                </blockquote>
                <ul>
                    <li><strong>"S·ªü h·ªØu" (Own):</strong> L√† nh·ªØng code n·∫±m trong codebase c·ªßa b·∫°n, do ƒë·ªôi nh√≥m c·ªßa b·∫°n ph√°t tri·ªÉn v√† c√≥ th·ªÉ thay ƒë·ªïi ƒë∆∞·ª£c. V√≠ d·ª•: c√°c class service, domain model, repository c·ªßa ch√≠nh b·∫°n.</li>
                    <li><strong>"Kh√¥ng s·ªü h·ªØu" (Don't Own):</strong> L√† nh·ªØng code ƒë·∫øn t·ª´ th∆∞ vi·ªán c·ªßa b√™n th·ª© ba ho·∫∑c c√°c h·ªá th·ªëng b√™n ngo√†i m√† b·∫°n kh√¥ng ki·ªÉm so√°t. V√≠ d·ª•: `StripeClient` (thanh to√°n), `SmtpClient` (g·ª≠i email), `FileSystem`, `DateTime.Now()`.</li>
                </ul>
                <p>L√Ω do ƒë·∫±ng sau quy t·∫Øc n√†y l√†: vi·ªác mock c√°c type b·∫°n s·ªü h·ªØu s·∫Ω khi·∫øn b√†i test c·ªßa b·∫°n b·ªã g·∫Øn ch·∫∑t v√†o <strong><span class="keyword" data-keyword="implementation-details">chi ti·∫øt c√†i ƒë·∫∑t</span></strong>, vi ph·∫°m Tr·ª• c·ªôt s·ªë 2 (Ch·ªëng ch·ªãu <span class="keyword" data-keyword="refactor">refactor</span>).</p>

                <h2>√Åp d·ª•ng v√†o <span class="keyword" data-keyword="hexagonal-architecture">Ki·∫øn tr√∫c L·ª•c gi√°c</span></h2>
                <p>Ki·∫øn tr√∫c n√†y (c√≤n g·ªçi l√† Ports and Adapters) gi√∫p l√†m r√µ ranh gi·ªõi "s·ªü h·ªØu".</p>
                <ol>
                    <li><strong>L√µi ·ª©ng d·ª•ng (<span class="keyword" data-keyword="domain-layer">Domain Layer</span> & <span class="keyword" data-keyword="application-services-layer">Application Services Layer</span>):</strong> ƒê√¢y l√† code b·∫°n "s·ªü h·ªØu" 100%. N√≥ ch·ª©a to√†n b·ªô logic nghi·ªáp v·ª• v√† kh√¥ng bi·∫øt g√¨ v·ªÅ th·∫ø gi·ªõi b√™n ngo√†i.</li>
                    <li><strong>Ports:</strong> L√† c√°c interface (v√≠ d·ª•: `IUserRepository`, `IEmailGateway`) ƒë·ªãnh nghƒ©a c√°ch l√µi ·ª©ng d·ª•ng mu·ªën giao ti·∫øp. ƒê√¢y c≈©ng l√† code b·∫°n "s·ªü h·ªØu".</li>
                    <li><strong>Adapters:</strong> L√† c√°c class c√†i ƒë·∫∑t c√°c Port ƒë·ªÉ giao ti·∫øp v·ªõi c√¥ng ngh·ªá c·ª• th·ªÉ. V√≠ d·ª•: `SqlUserRepository` (n√≥i chuy·ªán v·ªõi SQL), `SmtpEmailGateway` (n√≥i chuy·ªán v·ªõi SMTP). ƒê√¢y l√† c·∫ßu n·ªëi gi·ªØa code b·∫°n s·ªü h·ªØu v√† code b·∫°n kh√¥ng s·ªü h·ªØu.</li>
                </ol>

                <div style="text-align: center; margin: 2em 0;">
                     <img src="images/hexagonal_mocking_detailed.svg" alt="Quy t·∫Øc Mocking trong Ki·∫øn tr√∫c L·ª•c gi√°c" style="max-width: 90%;">
                </div>

                <h2>Quy t·∫Øc Mocking d·ª±a tr√™n ranh gi·ªõi</h2>
                <p>D·ª±a tr√™n ki·∫øn tr√∫c tr√™n, quy t·∫Øc tr·ªü n√™n r·∫•t r√µ r√†ng:</p>
                <ol>
                    <li><strong>Giao ti·∫øp n·ªôi b·ªô (Intra-system communications):</strong>
                        <ul>
                            <li><strong>L√† g√¨:</strong> S·ª± t∆∞∆°ng t√°c gi·ªØa c√°c class <strong>b√™n trong</strong> l√µi ·ª©ng d·ª•ng c·ªßa b·∫°n (v√≠ d·ª•: `OrderService` g·ªçi `ProductRepository`).</li>
                            <li><strong>Quy t·∫Øc:</strong> <strong>KH√îNG ƒê∆Ø·ª¢C MOCK.</strong> V√¨ c·∫£ hai ƒë·ªÅu l√† code b·∫°n s·ªü h·ªØu. H√£y d√πng phi√™n b·∫£n th·∫≠t ho·∫∑c m·ªôt `Fake` (v√≠ d·ª•: `InMemoryProductRepository`). Vi·ªác mock ·ªü ƒë√¢y s·∫Ω t·∫°o ra c√°c b√†i test mong manh.</li>
                        </ul>
                    </li>
                    <li><strong>Giao ti·∫øp v·ªõi h·ªá th·ªëng ngo√†i (Inter-system communications):</strong>
                        <ul>
                            <li><strong>L√† g√¨:</strong> S·ª± t∆∞∆°ng t√°c t·ª´ l√µi ·ª©ng d·ª•ng c·ªßa b·∫°n ƒëi ra m·ªôt <strong>h·ªá th·ªëng b√™n ngo√†i</strong> m√† b·∫°n kh√¥ng ki·ªÉm so√°t (v√≠ d·ª•: g·ª≠i email qua SMTP server, g·ªçi <span class="keyword" data-keyword="api">API</span> thanh to√°n c·ªßa b√™n th·ª© ba).</li>
                            <li><strong>Quy t·∫Øc:</strong> <strong>N√äN D√ôNG MOCK.</strong> ƒê√¢y ch√≠nh l√† ranh gi·ªõi c·ªßa ·ª©ng d·ª•ng. B·∫°n mock Port (`IEmailGateway`) ƒë·ªÉ x√°c minh r·∫±ng l√µi ·ª©ng d·ª•ng ƒë√£ g·ªçi ƒë√∫ng l·ªánh c·∫ßn thi·∫øt. B√†i test kh√¥ng c·∫ßn quan t√¢m Adapter (`SmtpEmailGateway`) ho·∫°t ƒë·ªông ra sao.</li>
                        </ul>
                    </li>
                </ol>

                <div class="example-box">
                    <h3>V√≠ d·ª•: Mock ƒë√∫ng v√† sai</h3>
                    <p>X√©t m·ªôt `UserService` c·∫ßn l∆∞u ng∆∞·ªùi d√πng v√†o DB v√† g·ª≠i email ch√†o m·ª´ng.</p>
<pre><code class="language-python"># --- Code b·∫°n s·ªü h·ªØu ---
class UserRepository: # Adapter n√≥i chuy·ªán v·ªõi DB
    def save(self, user): ...

class UserService:
    def __init__(self, user_repo, email_gateway):
        self._user_repo = user_repo
        self._email_gateway = email_gateway

    def register(self, user_data):
        # ... logic ...
        self._user_repo.save(user_data)
        self._email_gateway.send_welcome_email(user_data['email'])

# --- Code b·∫°n kh√¥ng s·ªü h·ªØu (gi·∫£ ƒë·ªãnh) ---
# class SmtpEmailGateway: ...
</code></pre>
                    <p><strong>‚ùå C√°ch test sai (mock c·∫£ code s·ªü h·ªØu):</strong></p>
<pre><code class="language-python">def test_register_user_WRONG(mocker):
    # SAI: Mock UserRepository l√† code b·∫°n s·ªü h·ªØu
    mock_repo = mocker.patch("my_app.UserRepository")
    mock_email = mocker.patch("my_app.EmailGateway")

    service = UserService(mock_repo, mock_email)
    service.register({"email": "a@b.com"})

    mock_repo.save.assert_called_once() # Test mong manh!
    mock_email.send_welcome_email.assert_called_once()
</code></pre>
                    <p><strong>‚úÖ C√°ch test ƒë√∫ng (ch·ªâ mock code kh√¥ng s·ªü h·ªØu):</strong></p>
<pre><code class="language-python"># D√πng m·ªôt phi√™n b·∫£n Fake cho code s·ªü h·ªØu
class FakeUserRepository:
    def __init__(self): self.users = []
    def save(self, user): self.users.append(user)

def test_register_user_CORRECT(mocker):
    fake_repo = FakeUserRepository() # D√πng Fake
    mock_email = mocker.patch("my_app.EmailGateway") # ƒê√öNG: Mock code kh√¥ng s·ªü h·ªØu

    service = UserService(fake_repo, mock_email)
    service.register({"email": "a@b.com"})

    assert len(fake_repo.users) == 1 # Test tr·∫°ng th√°i, b·ªÅn v·ªØng h∆°n
    mock_email.send_welcome_email.assert_called_once()
</code></pre>
                </div>
            </section>

            <section id="glossary" class="content-section">
                <h1>T·ª´ ƒëi·ªÉn thu·∫≠t ng·ªØ</h1>
                <p>ƒê√¢y l√† n∆°i t·ªïng h·ª£p ƒë·ªãnh nghƒ©a chi ti·∫øt cho c√°c thu·∫≠t ng·ªØ quan tr·ªçng ƒë∆∞·ª£c s·ª≠ d·ª•ng trong wiki n√†y.</p>
                <!-- ƒê·ªãnh nghƒ©a chi ti·∫øt s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
            </section>

            <section id="pytest-hands-on" class="content-section">
                <h1>Th·ª±c h√†nh v·ªõi PyTest</h1>
                <p>PyTest l√† m·ªôt testing framework m·∫°nh m·∫Ω v√† ph·ªï bi·∫øn trong h·ªá sinh th√°i Python. N√≥ n·ªïi ti·∫øng v·ªõi c√∫ ph√°p ƒë∆°n gi·∫£n, d·ªÖ ƒë·ªçc v√† kh·∫£ nƒÉng m·ªü r·ªông tuy·ªát v·ªùi.</p>

                <h2>1. C·∫•u tr√∫c Test c∆° b·∫£n & M·∫´u AAA</h2>
                <p>PyTest t·ª± ƒë·ªông ph√°t hi·ªán c√°c file test (c√≥ t√™n `test_*.py` ho·∫∑c `*_test.py`) v√† c√°c h√†m test (c√≥ t√™n `test_*`). H√£y xem c√°ch √°p d·ª•ng m·∫´u <span class="keyword" data-keyword="aaa">AAA</span> v·ªõi PyTest.</p>

                <h3>V√≠ d·ª•: M·ªôt h√†m t√≠nh t·ªïng ƒë∆°n gi·∫£n</h3>
                <p>Gi·∫£ s·ª≠ ch√∫ng ta c√≥ m·ªôt h√†m `add` trong file `calculator.py`:</p>
<pre><code class="language-python"># calculator.py
def add(a, b):
    return a + b
</code></pre>

                <p>B√¢y gi·ªù, ch√∫ng ta s·∫Ω vi·∫øt m·ªôt b√†i test cho h√†m n√†y trong file `test_calculator.py`:</p>
<pre><code class="language-python"># test_calculator.py
from calculator import add

def test_add_positive_numbers():
    # 1. Arrange (S·∫Øp ƒë·∫∑t)
    num1 = 5
    num2 = 10

    # 2. Act (H√†nh ƒë·ªông)
    result = add(num1, num2)

    # 3. Assert (X√°c minh)
    assert result == 15
</code></pre>
                <p>Ch·ªâ c·∫ßn ch·∫°y l·ªánh `pytest` trong terminal, PyTest s·∫Ω t·ª± ƒë·ªông t√¨m v√† ch·∫°y b√†i test n√†y.</p>

                <div class="question-box">
                    <p><strong>C√¢u h·ªèi c·ªßng c·ªë:</strong> D·ª±a v√†o v√≠ d·ª• tr√™n, h√£y vi·∫øt m·ªôt b√†i test kh√°c c√≥ t√™n l√† `test_add_negative_numbers` ƒë·ªÉ ki·ªÉm tra tr∆∞·ªùng h·ª£p c·ªông hai s·ªë √¢m (-2 v√† -3).</p>
                    <button class="btn show-answer-btn">Xem ƒë√°p √°n</button>
                    <div class="answer-content" style="display: none;">
<pre><code class="language-python"># test_calculator.py
from calculator import add

# ... (b√†i test c≈©) ...

def test_add_negative_numbers():
    # Arrange
    num1 = -2
    num2 = -3

    # Act
    result = add(num1, num2)

    # Assert
    assert result == -5
</code></pre>
                    </div>
                </div>

                <h2>2. Assertions (X√°c minh)</h2>
                <p>PyTest s·ª≠ d·ª•ng c√¢u l·ªánh `assert` ti√™u chu·∫©n c·ªßa Python, gi√∫p cho c√°c b√†i test tr·ªü n√™n r·∫•t t·ª± nhi√™n v√† d·ªÖ ƒë·ªçc. PyTest s·∫Ω cung c·∫•p th√¥ng tin chi ti·∫øt khi m·ªôt `assert` th·∫•t b·∫°i.</p>

                <h3>C√°c lo·∫°i Assertions ph·ªï bi·∫øn</h3>
                <ul>
                    <li>`assert a == b` (So s√°nh b·∫±ng)</li>
                    <li>`assert a != b` (So s√°nh kh√°c)</li>
                    <li>`assert a < b` ho·∫∑c `assert a > b` (So s√°nh l·ªõn/nh·ªè h∆°n)</li>
                    <li>`assert item in collection` (Ki·ªÉm tra s·ª± t·ªìn t·∫°i trong list/tuple/dict)</li>
                    <li>`assert isinstance(obj, MyClass)` (Ki·ªÉm tra ki·ªÉu c·ªßa ƒë·ªëi t∆∞·ª£ng)</li>
                </ul>

                <h3>V√≠ d·ª•: Ki·ªÉm tra m·ªôt ngo·∫°i l·ªá (Exception)</h3>
                <p>N·∫øu h√†m c·ªßa b·∫°n c·∫ßn ph·∫£i n√©m ra m·ªôt ngo·∫°i l·ªá trong m·ªôt tr∆∞·ªùng h·ª£p n√†o ƒë√≥, b·∫°n c√≥ th·ªÉ d√πng `pytest.raises`:</p>
<pre><code class="language-python"># calculator.py
def divide(a, b):
    if b == 0:
        raise ValueError("Cannot divide by zero")
    return a / b

# test_calculator.py
import pytest
from calculator import divide

def test_divide_by_zero_raises_exception():
    # Arrange
    num1 = 10
    num2 = 0

    # Act & Assert
    with pytest.raises(ValueError) as exc_info:
        divide(num1, num2)

    # (Optional) Ki·ªÉm tra n·ªôi dung c·ªßa exception
    assert "Cannot divide by zero" in str(exc_info.value)
</code></pre>

                <h2>3. Test Doubles (Mocks & Stubs) v·ªõi `pytest-mock`</h2>
                <p>ƒê·ªÉ s·ª≠ d·ª•ng Mocks v√† Stubs trong PyTest, th∆∞ vi·ªán `pytest-mock` l√† l·ª±a ch·ªçn ph·ªï bi·∫øn nh·∫•t. N√≥ cung c·∫•p m·ªôt fixture t√™n l√† `mocker` ƒë·ªÉ d·ªÖ d√†ng t·∫°o c√°c ƒë·ªëi t∆∞·ª£ng gi·∫£.</p>
                <p>ƒê·∫ßu ti√™n, b·∫°n c·∫ßn c√†i ƒë·∫∑t n√≥: `pip install pytest-mock`</p>

                <h3>V√≠ d·ª•: Gi·∫£ l·∫≠p m·ªôt API call (Stub)</h3>
                <p>H√£y t∆∞·ªüng t∆∞·ª£ng ch√∫ng ta c√≥ m·ªôt h√†m l·∫•y t·ªâ gi√° Bitcoin t·ª´ m·ªôt API b√™n ngo√†i.</p>
<pre><code class="language-python"># currency_service.py
import requests

def get_bitcoin_price_in_usd():
    try:
        response = requests.get("https://api.coindesk.com/v1/bpi/currentprice/USD.json")
        response.raise_for_status() # N√©m l·ªói n·∫øu request th·∫•t b·∫°i
        data = response.json()
        return data["bpi"]["USD"]["rate_float"]
    except requests.RequestException:
        return None
</code></pre>
                <p>Vi·ªác g·ªçi API th·∫≠t trong unit test s·∫Ω l√†m test ch·∫≠m v√† kh√¥ng ·ªïn ƒë·ªãnh. Ch√∫ng ta s·∫Ω d√πng `mocker` ƒë·ªÉ gi·∫£ l·∫≠p (stub) l·ªùi g·ªçi `requests.get`.</p>
<pre><code class="language-python"># test_currency_service.py
from currency_service import get_bitcoin_price_in_usd

def test_get_bitcoin_price_success(mocker):
    # Arrange
    # T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng mock response
    mock_response = mocker.Mock()
    mock_response.json.return_value = {
        "bpi": {
            "USD": {
                "rate_float": 50000.0
            }
        }
    }
    mock_response.raise_for_status.return_value = None # Kh√¥ng l√†m g√¨ khi g·ªçi

    # Gi·∫£ l·∫≠p 'requests.get' v√† b·∫£o n√≥ tr·∫£ v·ªÅ mock_response
    mocker.patch("requests.get", return_value=mock_response)

    # Act
    price = get_bitcoin_price_in_usd()

    # Assert
    assert price == 50000.0
</code></pre>

                <h3>V√≠ d·ª•: X√°c minh m·ªôt h√†nh ƒë·ªông (Mock)</h3>
                <p>Gi·∫£ s·ª≠ sau khi ƒëƒÉng k√Ω ng∆∞·ªùi d√πng, h·ªá th·ªëng c·∫ßn ph·∫£i g·ª≠i m·ªôt email ch√†o m·ª´ng.</p>
<pre><code class="language-python"># user_service.py
from email_sender import send_welcome_email

class UserService:
    def __init__(self, db_connection):
        self.db = db_connection

    def register_user(self, email, password):
        # ... logic l∆∞u user v√†o database ...
        user = {"email": email}
        self.db.save(user)

        # G·ª≠i email sau khi l∆∞u th√†nh c√¥ng
        send_welcome_email(email)
        return user
</code></pre>
                <p>Ch√∫ng ta kh√¥ng mu·ªën g·ª≠i email th·∫≠t. Ch√∫ng ta ch·ªâ mu·ªën x√°c minh r·∫±ng h√†m `send_welcome_email` ƒë√£ ƒë∆∞·ª£c g·ªçi ƒë√∫ng.</p>
<pre><code class="language-python"># test_user_service.py
from user_service import UserService

def test_register_user_sends_welcome_email(mocker):
    # Arrange
    # Gi·∫£ l·∫≠p h√†m send_welcome_email
    mock_send_email = mocker.patch("user_service.send_welcome_email")

    # T·∫°o m·ªôt DB connection gi·∫£
    mock_db = mocker.Mock()

    service = UserService(db_connection=mock_db)

    # Act
    service.register_user("test@example.com", "password123")

    # Assert
    # X√°c minh r·∫±ng mock_send_email ƒë√£ ƒë∆∞·ª£c g·ªçi ƒë√∫ng m·ªôt l·∫ßn v·ªõi ƒë√∫ng tham s·ªë
    mock_send_email.assert_called_once_with("test@example.com")

    # C≈©ng c√≥ th·ªÉ x√°c minh r·∫±ng user ƒë√£ ƒë∆∞·ª£c l∆∞u
    mock_db.save.assert_called_once()
</code></pre>

                <div class="question-box">
                    <p><strong>C√¢u h·ªèi c·ªßng c·ªë:</strong> Trong v√≠ d·ª• v·ªÅ `test_get_bitcoin_price_success`, ch√∫ng ta ƒë√£ stub tr∆∞·ªùng h·ª£p th√†nh c√¥ng. H√£y vi·∫øt m·ªôt b√†i test m·ªõi t√™n l√† `test_get_bitcoin_price_failure` ƒë·ªÉ ki·ªÉm tra tr∆∞·ªùng h·ª£p `requests.get` n√©m ra m·ªôt l·ªói `RequestException`.</p>
                    <button class="btn show-answer-btn">Xem ƒë√°p √°n</button>
                    <div class="answer-content" style="display: none;">
<pre><code class="language-python"># test_currency_service.py
import requests
from currency_service import get_bitcoin_price_in_usd

# ... (b√†i test c≈©) ...

def test_get_bitcoin_price_failure(mocker):
    # Arrange
    # Gi·∫£ l·∫≠p 'requests.get' ƒë·ªÉ n√≥ n√©m ra m·ªôt l·ªói khi ƒë∆∞·ª£c g·ªçi
    mocker.patch("requests.get", side_effect=requests.RequestException("API is down"))

    # Act
    price = get_bitcoin_price_in_usd()

    # Assert
    # Mong ƒë·ª£i k·∫øt qu·∫£ l√† None khi c√≥ l·ªói x·∫£y ra
    assert price is None
</code></pre>
                    </div>
                </div>

            </section>

            <section id="gtest-hands-on" class="content-section">
                <h1>Th·ª±c h√†nh v·ªõi GoogleTest (GTest)</h1>
                <p>GoogleTest (th∆∞·ªùng g·ªçi l√† GTest) l√† m·ªôt framework unit testing h√†ng ƒë·∫ßu cho C++. N√≥ cung c·∫•p m·ªôt b·ªô assertions phong ph√∫, c∆° ch·∫ø test fixtures m·∫°nh m·∫Ω, v√† ƒë∆∞·ª£c t√≠ch h·ª£p ch·∫∑t ch·∫Ω v·ªõi GoogleMock (GMock) ƒë·ªÉ t·∫°o c√°c ƒë·ªëi t∆∞·ª£ng gi·∫£.</p>
                <p><em>L∆∞u √Ω: C√°c v√≠ d·ª• d∆∞·ªõi ƒë√¢y gi·∫£ ƒë·ªãnh b·∫°n ƒë√£ thi·∫øt l·∫≠p GTest v√† GMock trong m√¥i tr∆∞·ªùng build c·ªßa m√¨nh (v√≠ d·ª•: qua CMake).</em></p>

                <h2>1. C·∫•u tr√∫c Test c∆° b·∫£n & M·∫´u AAA</h2>
                <p>Trong GTest, c√°c b√†i test ƒë∆∞·ª£c nh√≥m l·∫°i trong c√°c "Test Case" (ho·∫∑c "Test Suite") b·∫±ng macro `TEST()`. Macro n√†y nh·∫≠n hai tham s·ªë: t√™n c·ªßa Test Case v√† t√™n c·ªßa b√†i test c·ª• th·ªÉ.</p>

                <h3>V√≠ d·ª•: M·ªôt h√†m t√≠nh t·ªïng ƒë∆°n gi·∫£n</h3>
                <p>Gi·∫£ s·ª≠ ch√∫ng ta c√≥ m·ªôt h√†m `add` trong file `calculator.h`:</p>
<pre><code class="language-cpp">// calculator.h
#ifndef CALCULATOR_H
#define CALCULATOR_H

int add(int a, int b);

#endif // CALCULATOR_H

// calculator.cpp
#include "calculator.h"

int add(int a, int b) {
    return a + b;
}
</code></pre>

                <p>File test (`test_calculator.cpp`) s·∫Ω tr√¥ng nh∆∞ sau:</p>
<pre><code class="language-cpp">// test_calculator.cpp
#include &lt;gtest/gtest.h&gt;
#include "calculator.h" // Include file ch·ª©a code c·∫ßn test

// C√∫ ph√°p: TEST(TestCaseName, TestName)
TEST(CalculatorTest, AddPositiveNumbers) {
    // 1. Arrange (S·∫Øp ƒë·∫∑t)
    int num1 = 5;
    int num2 = 10;

    // 2. Act (H√†nh ƒë·ªông)
    int result = add(num1, num2);

    // 3. Assert (X√°c minh)
    ASSERT_EQ(result, 15);
}
</code></pre>

                <div class="question-box">
                    <p><strong>C√¢u h·ªèi c·ªßng c·ªë:</strong> D·ª±a v√†o v√≠ d·ª• tr√™n, h√£y vi·∫øt m·ªôt b√†i test kh√°c c√≥ t√™n l√† `AddNegativeNumbers` trong c√πng Test Case `CalculatorTest` ƒë·ªÉ ki·ªÉm tra tr∆∞·ªùng h·ª£p c·ªông hai s·ªë √¢m (-5 v√† -10).</p>
                    <button class="btn show-answer-btn">Xem ƒë√°p √°n</button>
                    <div class="answer-content" style="display: none;">
<pre><code class="language-cpp">// test_calculator.cpp
#include &lt;gtest/gtest.h&gt;
#include "calculator.h"

// ... (b√†i test c≈©) ...

TEST(CalculatorTest, AddNegativeNumbers) {
    // Arrange
    int num1 = -5;
    int num2 = -10;

    // Act
    int result = add(num1, num2);

    // Assert
    ASSERT_EQ(result, -15);
}
</code></pre>
                    </div>
                </div>

                <h2>2. Assertions (X√°c minh)</h2>
                <p>GTest cung c·∫•p m·ªôt b·ªô macro assertion ƒëa d·∫°ng, ƒë∆∞·ª£c chia th√†nh hai lo·∫°i:</p>
                <ul>
                    <li>`ASSERT_*`: Khi m·ªôt assertion n√†y th·∫•t b·∫°i, n√≥ s·∫Ω <strong>ch·∫•m d·ª©t b√†i test ngay l·∫≠p t·ª©c</strong>.</li>
                    <li>`EXPECT_*`: Khi m·ªôt assertion n√†y th·∫•t b·∫°i, n√≥ s·∫Ω ghi nh·∫≠n l·ªói nh∆∞ng <strong>v·∫´n ti·∫øp t·ª•c ch·∫°y c√°c ph·∫ßn c√≤n l·∫°i</strong> c·ªßa b√†i test. H·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p b·∫°n n√™n d√πng `EXPECT_*`.</li>
                </ul>

                <h3>C√°c Assertions ph·ªï bi·∫øn</h3>
                <ul>
                    <li>`EXPECT_EQ(val1, val2);` (B·∫±ng nhau)</li>
                    <li>`EXPECT_NE(val1, val2);` (Kh√¥ng b·∫±ng nhau)</li>
                    <li>`EXPECT_LT(val1, val2);` (Nh·ªè h∆°n)</li>
                    <li>`EXPECT_GT(val1, val2);` (L·ªõn h∆°n)</li>
                    <li>`EXPECT_TRUE(condition);` (ƒêi·ªÅu ki·ªán l√† ƒë√∫ng)</li>
                    <li>`EXPECT_FALSE(condition);` (ƒêi·ªÅu ki·ªán l√† sai)</li>
                    <li>`EXPECT_THROW(statement, exception_type);` (N√©m ra ngo·∫°i l·ªá)</li>
                </ul>

                <h3>V√≠ d·ª•: Ki·ªÉm tra ngo·∫°i l·ªá</h3>
<pre><code class="language-cpp">// calculator.h
#include &lt;stdexcept&gt;
// ...
double divide(double a, double b) {
    if (b == 0) {
        throw std::invalid_argument("Cannot divide by zero");
    }
    return a / b;
}

// test_calculator.cpp
TEST(CalculatorTest, DivideByZeroThrowsException) {
    // Arrange
    double num1 = 10.0;
    double num2 = 0.0;

    // Act & Assert
    EXPECT_THROW(divide(num1, num2), std::invalid_argument);
}
</code></pre>

                <h2>3. Test Doubles v·ªõi GoogleMock (GMock)</h2>
                <p>GMock ƒë∆∞·ª£c d√πng ƒë·ªÉ t·∫°o c√°c ƒë·ªëi t∆∞·ª£ng gi·∫£ (mocks) trong C++. ƒêi·ªÅu n√†y ƒë·∫∑c bi·ªát h·ªØu √≠ch khi b·∫°n c·∫ßn gi·∫£ l·∫≠p m·ªôt dependency l√† m·ªôt interface (m·ªôt class tr·ª´u t∆∞·ª£ng v·ªõi c√°c h√†m virtual thu·∫ßn t√∫y).</p>

                <h3>V√≠ d·ª•: Gi·∫£ l·∫≠p m·ªôt Database (Stub & Mock)</h3>
                <p>Gi·∫£ s·ª≠ ch√∫ng ta c√≥ m·ªôt interface `Database` v√† m·ªôt class `UserService` s·ª≠ d·ª•ng n√≥.</p>
<pre><code class="language-cpp">// database.h
class Database {
public:
    virtual ~Database() = default;
    virtual bool userExists(const std::string& email) = 0;
    virtual void saveUser(const std::string& email) = 0;
};

// user_service.h
#include "database.h"
class UserService {
public:
    explicit UserService(Database* db) : database(db) {}

    bool registerUser(const std::string& email) {
        if (database-&gt;userExists(email)) {
            return false; // User ƒë√£ t·ªìn t·∫°i
        }
        database-&gt;saveUser(email);
        return true;
    }
private:
    Database* database;
};
</code></pre>

                <p>ƒê·ªÉ test `UserService`, ch√∫ng ta s·∫Ω t·∫°o m·ªôt `MockDatabase` b·∫±ng GMock.</p>
<pre><code class="language-cpp">// test_user_service.cpp
#include &lt;gtest/gtest.h&gt;
#include &lt;gmock/gmock.h&gt;
#include "user_service.h"
#include "database.h"

// 1. T·∫°o class Mock t·ª´ interface
class MockDatabase : public Database {
public:
    // MOCK_METHOD(return_type, method_name, (arg_types), (qualifiers));
    MOCK_METHOD(bool, userExists, (const std::string& email), (override));
    MOCK_METHOD(void, saveUser, (const std::string& email), (override));
};

TEST(UserServiceTest, RegisterNewUserSuccessfully) {
    // Arrange
    MockDatabase mockDb;
    UserService service(&amp;mockDb);
    std::string newUserEmail = "new_user@test.com";

    // Thi·∫øt l·∫≠p h√†nh vi cho Mock (ƒë√≥ng vai tr√≤ Stub)
    // Khi userExists ƒë∆∞·ª£c g·ªçi v·ªõi email n√†y, h√£y tr·∫£ v·ªÅ false
    EXPECT_CALL(mockDb, userExists(newUserEmail))
        .WillOnce(testing::Return(false));

    // Thi·∫øt l·∫≠p k·ª≥ v·ªçng (ƒë√≥ng vai tr√≤ Mock)
    // K·ª≥ v·ªçng r·∫±ng saveUser s·∫Ω ƒë∆∞·ª£c g·ªçi ƒë√∫ng m·ªôt l·∫ßn v·ªõi email n√†y
    EXPECT_CALL(mockDb, saveUser(newUserEmail))
        .Times(1);

    // Act
    bool result = service.registerUser(newUserEmail);

    // Assert
    ASSERT_TRUE(result);
}
</code></pre>

                <div class="question-box">
                    <p><strong>C√¢u h·ªèi c·ªßng c·ªë:</strong> H√£y vi·∫øt m·ªôt b√†i test m·ªõi t√™n l√† `RegisterExistingUserFails` ƒë·ªÉ ki·ªÉm tra tr∆∞·ªùng h·ª£p ng∆∞·ªùi d√πng ƒë√£ t·ªìn t·∫°i. Trong tr∆∞·ªùng h·ª£p n√†y, h√†m `saveUser` kh√¥ng bao gi·ªù ƒë∆∞·ª£c ph√©p g·ªçi t·ªõi.</p>
                    <button class="btn show-answer-btn">Xem ƒë√°p √°n</button>
                    <div class="answer-content" style="display: none;">
<pre><code class="language-cpp">TEST(UserServiceTest, RegisterExistingUserFails) {
    // Arrange
    MockDatabase mockDb;
    UserService service(&amp;mockDb);
    std::string existingUserEmail = "exists@test.com";

    // Thi·∫øt l·∫≠p h√†nh vi (Stub)
    // Khi userExists ƒë∆∞·ª£c g·ªçi, h√£y tr·∫£ v·ªÅ true
    EXPECT_CALL(mockDb, userExists(existingUserEmail))
        .WillOnce(testing::Return(true));

    // Thi·∫øt l·∫≠p k·ª≥ v·ªçng (Mock)
    // K·ª≥ v·ªçng r·∫±ng saveUser s·∫Ω kh√¥ng bao gi·ªù ƒë∆∞·ª£c g·ªçi
    EXPECT_CALL(mockDb, saveUser(testing::_))
        .Times(0);

    // Act
    bool result = service.registerUser(existingUserEmail);

    // Assert
    ASSERT_FALSE(result);
}
</code></pre>
                        <p>L∆∞u √Ω: `testing::_` l√† m·ªôt "matcher" trong GMock, c√≥ nghƒ©a l√† "b·∫•t k·ª≥ gi√° tr·ªã n√†o".</p>
                    </div>
                </div>

            </section>

            <section id="concurrency-intro" class="content-section">
                <h1>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Concurrency & Systems</h1>
                <p>Ph·∫ßn n√†y c·ªßa wiki t·∫≠p trung v√†o c√°c kh√°i ni·ªám l·∫≠p tr√¨nh h·ªá th·ªëng v√† ƒë·ªìng th·ªùi (concurrency), nh·ªØng n·ªÅn t·∫£ng quan tr·ªçng cho b·∫•t k·ª≥ l·∫≠p tr√¨nh vi√™n n√†o mu·ªën x√¢y d·ª±ng c√°c ·ª©ng d·ª•ng hi·ªáu su·∫•t cao v√† ƒë√°ng tin c·∫≠y.</p>
                <h2>T·∫°i sao c·∫ßn h·ªçc v·ªÅ Concurrency?</h2>
                <ul>
                    <li><strong>T·∫≠n d·ª•ng ph·∫ßn c·ª©ng hi·ªán ƒë·∫°i:</strong> H·∫ßu h·∫øt c√°c CPU hi·ªán nay ƒë·ªÅu c√≥ nhi·ªÅu l√µi (multi-core). L·∫≠p tr√¨nh ƒë·ªìng th·ªùi cho ph√©p b·∫°n th·ª±c thi c√°c t√°c v·ª• song song, t·∫≠n d·ª•ng t·ªëi ƒëa s·ª©c m·∫°nh c·ªßa ph·∫ßn c·ª©ng.</li>
                    <li><strong>C·∫£i thi·ªán kh·∫£ nƒÉng ph·∫£n h·ªìi (Responsiveness):</strong> Trong c√°c ·ª©ng d·ª•ng c√≥ giao di·ªán ng∆∞·ªùi d√πng (UI), vi·ªác ch·∫°y c√°c t√°c v·ª• n·∫∑ng (nh∆∞ x·ª≠ l√Ω file, g·ªçi m·∫°ng) trong m·ªôt lu·ªìng ri√™ng s·∫Ω gi√∫p UI kh√¥ng b·ªã "ƒë√≥ng bƒÉng", mang l·∫°i tr·∫£i nghi·ªám m∆∞·ª£t m√† cho ng∆∞·ªùi d√πng.</li>
                    <li><strong>X·ª≠ l√Ω c√°c v·∫•n ƒë·ªÅ trong th·∫ø gi·ªõi th·ª±c:</strong> Nhi·ªÅu h·ªá th·ªëng trong th·ª±c t·∫ø v·ªën c√≥ b·∫£n ch·∫•t l√† ƒë·ªìng th·ªùi, v√≠ d·ª• nh∆∞ m·ªôt web server ph·∫£i x·ª≠ l√Ω h√†ng ng√†n y√™u c·∫ßu t·ª´ client c√πng m·ªôt l√∫c.</li>
                </ul>
                <h2>N·ªôi dung ch√≠nh</h2>
                <p>Ch√∫ng t√¥i s·∫Ω kh√°m ph√° c√°c ch·ªß ƒë·ªÅ t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao, bao g·ªìm:</p>
                <ol>
                    <li><strong>Ti·∫øn tr√¨nh (Processes) v√† T√≠n hi·ªáu (Signals):</strong> ƒê∆°n v·ªã th·ª±c thi c∆° b·∫£n nh·∫•t trong h·ªá ƒëi·ªÅu h√†nh v√† c√°ch ch√∫ng giao ti·∫øp.</li>
                    <li><strong>Lu·ªìng (Threads):</strong> C√°c ƒë∆°n v·ªã th·ª±c thi "nh·∫π" h∆°n b√™n trong m·ªôt ti·∫øn tr√¨nh v√† c√°ch ch√∫ng chia s·∫ª t√†i nguy√™n.</li>
                    <li><strong>L·∫≠p tr√¨nh ƒë·ªìng th·ªùi trong Python:</strong> So s√°nh gi·ªØa `threading`, `multiprocessing` v√† t√¨m hi·ªÉu v·ªÅ "n√∫t th·∫Øt c·ªï chai" Global Interpreter Lock (GIL).</li>
                    <li><strong>C√°c c∆° ch·∫ø Giao ti·∫øp gi·ªØa ti·∫øn tr√¨nh (IPC):</strong> T√¨m hi·ªÉu c√°ch c√°c ti·∫øn tr√¨nh ƒë·ªôc l·∫≠p c√≥ th·ªÉ trao ƒë·ªïi d·ªØ li·ªáu v·ªõi nhau m·ªôt c√°ch an to√†n.</li>
                </ol>
                <blockquote>
                    <p>L·∫≠p tr√¨nh ƒë·ªìng th·ªùi l√† m·ªôt ch·ªß ƒë·ªÅ ƒë·∫ßy th√°ch th·ª©c, v·ªõi nh·ªØng c·∫°m b·∫´y nh∆∞ <strong>race conditions</strong> v√† <strong>deadlocks</strong>. Tuy nhi√™n, vi·ªác n·∫Øm v·ªØng n√≥ s·∫Ω m·ªü ra cho b·∫°n m·ªôt c·∫•p ƒë·ªô m·ªõi trong kh·∫£ nƒÉng thi·∫øt k·∫ø v√† t·ªëi ∆∞u h√≥a ph·∫ßn m·ªÅm.</p>
                </blockquote>
                <p>H√£y b·∫Øt ƒë·∫ßu h√†nh tr√¨nh n√†y b·∫±ng c√°ch ch·ªçn m·ªôt ch·ªß ƒë·ªÅ t·ª´ thanh ƒëi·ªÅu h∆∞·ªõng!</p>
            </section>

            <section id="concurrency-processes" class="content-section">
                <h1>Processes & Signals üèÉ‚Äç‚ôÇÔ∏èüö¶</h1>
                <p>Trong Linux, m·ªçi ho·∫°t ƒë·ªông ƒë·ªÅu xoay quanh kh√°i ni·ªám <strong>ti·∫øn tr√¨nh (process)</strong>. Hi·ªÉu r√µ ti·∫øn tr√¨nh v√† c√°ch ch√∫ng giao ti·∫øp qua t√≠n hi·ªáu l√† ch√¨a kh√≥a ƒë·ªÉ l√†m ch·ªß h·ªá th·ªëng, ƒë·∫∑c bi·ªát trong l·∫≠p tr√¨nh h·ªá th·ªëng v√† nh√∫ng.</p>

                <h2>Module 1: Ti·∫øn tr√¨nh l√† g√¨?</h2>

                <h3>1.1. ƒê·ªãnh nghƒ©a v√† C·∫•u tr√∫c</h3>
                <ul>
                    <li>M·ªôt <strong>ti·∫øn tr√¨nh (process)</strong> l√† m·ªôt <strong>ch∆∞∆°ng tr√¨nh ƒëang th·ª±c thi</strong>. N√≥ l√† m·ªôt th·ª±c th·ªÉ ƒë·ªôc l·∫≠p, t·ª± ch·ª©a bao g·ªìm kh√¥ng ch·ªâ m√£ l·ªánh m√† c√≤n t·∫•t c·∫£ c√°c t√†i nguy√™n c·∫ßn thi·∫øt ƒë·ªÉ ch·∫°y.</li>
                    <li><strong>Th√†nh ph·∫ßn c·ªßa m·ªôt Ti·∫øn tr√¨nh:</strong>
                        <ul>
                            <li><strong>M√£ l·ªánh (Text Segment):</strong> M√£ th·ª±c thi, ch·ªâ ƒë·ªçc v√† c√≥ th·ªÉ chia s·∫ª.</li>
                            <li><strong>D·ªØ li·ªáu (Data/BSS Segment):</strong> Bi·∫øn to√†n c·ª•c v√† bi·∫øn tƒ©nh.</li>
                            <li><strong>Heap:</strong> V√πng b·ªô nh·ªõ ƒë·ªông (`malloc`/`new`).</li>
                            <li><strong>Stack:</strong> V√πng nh·ªõ cho bi·∫øn c·ª•c b·ªô, tham s·ªë h√†m.</li>
                            <li><strong>Process ID (PID):</strong> M·ªôt s·ªë nguy√™n duy nh·∫•t do Kernel g√°n cho m·ªói ti·∫øn tr√¨nh. PID 1 th∆∞·ªùng l√† `init` ho·∫∑c `systemd`.</li>
                        </ul>
                    </li>
                    <li>Kernel duy tr√¨ m·ªôt <strong>B·∫£ng Ti·∫øn tr√¨nh (Process Table)</strong> ƒë·ªÉ theo d√µi t·∫•t c·∫£ c√°c ti·∫øn tr√¨nh ƒëang ho·∫°t ƒë·ªông.</li>
                </ul>

                <h3>1.2. Xem Ti·∫øn tr√¨nh</h3>
                <p>C√°c l·ªánh sau cho ph√©p b·∫°n xem th√¥ng tin v·ªÅ c√°c ti·∫øn tr√¨nh ƒëang ch·∫°y:</p>
                <ul>
                    <li><strong><code>ps</code> (Process Status):</strong> Hi·ªÉn th·ªã ·∫£nh ch·ª•p (snapshot) c√°c ti·∫øn tr√¨nh.
                        <ul>
                            <li><code>ps -ef</code>: Hi·ªÉn th·ªã t·∫•t c·∫£ ti·∫øn tr√¨nh ·ªü ƒë·ªãnh d·∫°ng ƒë·∫ßy ƒë·ªß.</li>
                            <li><code>ps aux</code>: Hi·ªÉn th·ªã t·∫•t c·∫£ ti·∫øn tr√¨nh ·ªü ƒë·ªãnh d·∫°ng BSD.</li>
                        </ul>
                    </li>
                    <li><strong><code>top</code> / <code>htop</code>:</strong> Cung c·∫•p ch·∫ø ƒë·ªô xem ƒë·ªông, c·∫≠p nh·∫≠t li√™n t·ª•c v·ªÅ c√°c ti·∫øn tr√¨nh ti√™u th·ª• nhi·ªÅu t√†i nguy√™n nh·∫•t.</li>
                    <li><strong><code>/proc</code> file system:</strong> M·ªôt h·ªá th·ªëng file ·∫£o ch·ª©a th√¥ng tin chi ti·∫øt v·ªÅ m·ªói ti·∫øn tr√¨nh trong th∆∞ m·ª•c <code>/proc/&lt;PID&gt;/</code>.</li>
                </ul>
<pre><code class="language-bash"># Hi·ªÉn th·ªã 5 d√≤ng ƒë·∫ßu c·ªßa c√¢y ti·∫øn tr√¨nh
pstree | head -n 5

# Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt v·ªÅ c√°c ti·∫øn tr√¨nh
ps -e -o pid,ppid,user,stat,start,time,cmd
</code></pre>

                <h3>1.3. L·∫≠p l·ªãch Ti·∫øn tr√¨nh (Process Scheduling)</h3>
                <ul>
                    <li>Kernel Linux s·ª≠ d·ª•ng m·ªôt <strong>b·ªô l·∫≠p l·ªãch (scheduler)</strong> ƒë·ªÉ ph√¢n chia th·ªùi gian CPU gi·ªØa c√°c ti·∫øn tr√¨nh.</li>
                    <li><strong>Preemptive Multitasking:</strong> Kernel c√≥ th·ªÉ t·∫°m d·ª´ng (preempt) m·ªôt ti·∫øn tr√¨nh ƒëang ch·∫°y ƒë·ªÉ chuy·ªÉn sang ti·∫øn tr√¨nh kh√°c c√≥ ƒë·ªô ∆∞u ti√™n cao h∆°n.</li>
                    <li><strong>Nice Value (`NI`):</strong> M·ªôt gi√° tr·ªã t·ª´ <code>-20</code> (∆∞u ti√™n cao nh·∫•t) ƒë·∫øn <code>19</code> (∆∞u ti√™n th·∫•p nh·∫•t) ·∫£nh h∆∞·ªüng ƒë·∫øn ƒë·ªô ∆∞u ti√™n. Ch·ªâ `root` m·ªõi c√≥ th·ªÉ tƒÉng ∆∞u ti√™n (gi·∫£m gi√° tr·ªã nice).</li>
                </ul>

                <hr>
                <h2>Module 2: Kh·ªüi ƒë·ªông Ti·∫øn tr√¨nh M·ªõi</h2>

                <h3>2.1. <code>system()</code>: Ch·∫°y L·ªánh qua Shell</h3>
                <p>H√†m <code>system()</code> l√† c√°ch ƒë∆°n gi·∫£n nh·∫•t ƒë·ªÉ ch·∫°y m·ªôt l·ªánh b√™n ngo√†i. N√≥ t·∫°o m·ªôt shell con ƒë·ªÉ th·ª±c thi l·ªánh v√† ti·∫øn tr√¨nh cha s·∫Ω b·ªã ch·∫∑n cho ƒë·∫øn khi l·ªánh ho√†n th√†nh.</p>
<pre><code class="language-cpp">#include &lt;cstdlib&gt;

int main() {
    // Ch·∫°y l·ªánh 'ls -l' v√† ch·ªù n√≥ k·∫øt th√∫c
    system("ls -l");
    return 0;
}
</code></pre>
                <ul>
                    <li><strong>∆Øu ƒëi·ªÉm:</strong> ƒê∆°n gi·∫£n, ti·ªán l·ª£i.</li>
                    <li><strong>Nh∆∞·ª£c ƒëi·ªÉm:</strong> K√©m hi·ªáu qu·∫£ (t·ªën overhead), √≠t ki·ªÉm so√°t, v√† c√≥ r·ªßi ro b·∫£o m·∫≠t (command injection).</li>
                </ul>

                <h3>2.2. H·ªç h√†m <code>exec</code>: Thay th·∫ø ·∫¢nh Ti·∫øn tr√¨nh</h3>
                <p>H·ªç c√°c h√†m <code>exec</code> (<code>execlp</code>, <code>execvp</code>, ...) <strong>thay th·∫ø ho√†n to√†n</strong> m√£ l·ªánh v√† d·ªØ li·ªáu c·ªßa ti·∫øn tr√¨nh hi·ªán t·∫°i b·∫±ng m·ªôt ch∆∞∆°ng tr√¨nh m·ªõi. N√≥ <strong>kh√¥ng t·∫°o ti·∫øn tr√¨nh m·ªõi</strong> v√† gi·ªØ nguy√™n PID.</p>
<pre><code class="language-cpp">#include &lt;unistd.h&gt;

int main() {
    // Thay th·∫ø ti·∫øn tr√¨nh hi·ªán t·∫°i b·∫±ng 'ls -l /tmp'
    // D√≤ng code sau "execlp" s·∫Ω kh√¥ng bao gi·ªù ch·∫°y n·∫øu n√≥ th√†nh c√¥ng
    execlp("ls", "ls", "-l", "/tmp", (char *)0);
    perror("execlp failed"); // Ch·ªâ ch·∫°y n·∫øu c√≥ l·ªói
    return 1;
}
</code></pre>

                <h3>2.3. <code>fork()</code>: Nh√¢n b·∫£n Ti·∫øn tr√¨nh</h3>
                <p>H√†m <code>fork()</code> l√† system call c∆° b·∫£n ƒë·ªÉ <strong>t·∫°o m·ªôt ti·∫øn tr√¨nh con m·ªõi</strong> b·∫±ng c√°ch nh√¢n b·∫£n ti·∫øn tr√¨nh cha. C·∫£ hai ti·∫øn tr√¨nh ti·∫øp t·ª•c ch·∫°y t·ª´ ngay sau l·ªùi g·ªçi <code>fork()</code>.</p>
                <ul>
                    <li>Trong <strong>ti·∫øn tr√¨nh con</strong>, <code>fork()</code> tr·∫£ v·ªÅ <strong><code>0</code></strong>.</li>
                    <li>Trong <strong>ti·∫øn tr√¨nh cha</strong>, <code>fork()</code> tr·∫£ v·ªÅ <strong>PID c·ªßa ti·∫øn tr√¨nh con</strong>.</li>
                    <li>N·∫øu th·∫•t b·∫°i, n√≥ tr·∫£ v·ªÅ <code>-1</code>.</li>
                </ul>

                <h3>2.4. M√¥ h√¨nh <code>fork()</code> + <code>exec()</code></h3>
                <p>ƒê√¢y l√† c√°ch chu·∫©n ƒë·ªÉ kh·ªüi ch·∫°y m·ªôt ch∆∞∆°ng tr√¨nh m·ªõi trong m·ªôt ti·∫øn tr√¨nh ri√™ng bi·ªát:</p>
                <ol>
                    <li>Ti·∫øn tr√¨nh cha g·ªçi <code>fork()</code> ƒë·ªÉ t·∫°o con.</li>
                    <li>Trong nh√°nh c·ªßa ti·∫øn tr√¨nh con (<code>pid == 0</code>), n√≥ g·ªçi <code>exec()</code> ƒë·ªÉ ch·∫°y ch∆∞∆°ng tr√¨nh m·ªõi.</li>
                    <li>Trong nh√°nh c·ªßa ti·∫øn tr√¨nh cha (<code>pid > 0</code>), n√≥ c√≥ th·ªÉ ti·∫øp t·ª•c c√¥ng vi·ªác ho·∫∑c d√πng <code>wait()</code> ƒë·ªÉ ch·ªù con k·∫øt th√∫c.</li>
                </ol>
<pre><code class="language-cpp">#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

int main() {
    pid_t pid = fork();

    if (pid == 0) {
        // M√£ c·ªßa ti·∫øn tr√¨nh con
        execlp("echo", "echo", "Hello from child!", (char*)0);
        _exit(127); // Tho√°t n·∫øu exec th·∫•t b·∫°i
    } else if (pid > 0) {
        // M√£ c·ªßa ti·∫øn tr√¨nh cha
        wait(NULL); // Ch·ªù con k·∫øt th√∫c
        printf("Parent knows child has finished.\n");
    }
    return 0;
}
</code></pre>
                <hr>
                <h2>Module 3: Qu·∫£n l√Ω Ti·∫øn tr√¨nh Con</h2>

                <h3>3.1. <code>wait()</code> v√† <code>waitpid()</code>: Ch·ªù Con K·∫øt th√∫c</h3>
                <p>Ti·∫øn tr√¨nh cha c·∫ßn ch·ªù con ƒë·ªÉ thu th·∫≠p tr·∫°ng th√°i tho√°t v√† ngƒÉn ch√∫ng tr·ªü th√†nh "zombie".</p>
                <ul>
                    <li><strong><code>wait(int *status)</code>:</strong> Ch·∫∑n cha cho ƒë·∫øn khi <strong>b·∫•t k·ª≥</strong> ti·∫øn tr√¨nh con n√†o k·∫øt th√∫c.</li>
                    <li><strong><code>waitpid(pid_t pid, int *status, int options)</code>:</strong> Linh ho·∫°t h∆°n, c√≥ th·ªÉ ch·ªù m·ªôt PID c·ª• th·ªÉ. V·ªõi c·ªù <code>WNOHANG</code>, n√≥ s·∫Ω tr·∫£ v·ªÅ ngay l·∫≠p t·ª©c n·∫øu kh√¥ng c√≥ con n√†o k·∫øt th√∫c, cho ph√©p cha l√†m vi·ªác kh√°c.</li>
                </ul>
                <p>S·ª≠ d·ª•ng c√°c macro nh∆∞ <code>WIFEXITED(status)</code> v√† <code>WEXITSTATUS(status)</code> ƒë·ªÉ ph√¢n t√≠ch gi√° tr·ªã tr·∫°ng th√°i.</p>

                <h3>3.2. Zombie Processes üßü</h3>
                <p>M·ªôt <strong>ti·∫øn tr√¨nh zombie</strong> l√† m·ªôt ti·∫øn tr√¨nh con ƒë√£ k·∫øt th√∫c nh∆∞ng cha ch∆∞a thu th·∫≠p tr·∫°ng th√°i tho√°t c·ªßa n√≥ b·∫±ng <code>wait()</code>. Ch√∫ng kh√¥ng d√πng CPU/RAM nh∆∞ng chi·∫øm m·ªôt ch·ªó trong b·∫£ng ti·∫øn tr√¨nh.</p>
                <p><strong>C√°ch tr√°nh Zombie:</strong></p>
                <ol>
                    <li><strong>Lu√¥n g·ªçi <code>wait()</code> ho·∫∑c <code>waitpid()</code>:</strong> C√°ch t·ªët nh·∫•t v√† r√µ r√†ng nh·∫•t.</li>
                    <li><strong>B·ªè qua <code>SIGCHLD</code>:</strong> <code>signal(SIGCHLD, SIG_IGN);</code>. Kernel s·∫Ω t·ª± ƒë·ªông d·ªçn d·∫πp c√°c con ƒë√£ tho√°t.</li>
                    <li><strong>Double Fork:</strong> T·∫°o m·ªôt "ch√°u" v√† ƒë·ªÉ ti·∫øn tr√¨nh con ƒë·∫ßu ti√™n tho√°t ngay. Ch√°u s·∫Ω m·ªì c√¥i v√† ƒë∆∞·ª£c `init` (PID 1) nh·∫≠n nu√¥i, `init` s·∫Ω t·ª± ƒë·ªông d·ªçn d·∫πp n√≥.</li>
                </ol>

                <hr>
                <h2>Module 4: Signals (T√≠n hi·ªáu)</h2>

                <h3>4.1. T√≠n hi·ªáu l√† g√¨?</h3>
                <p><strong>T√≠n hi·ªáu</strong> l√† m·ªôt d·∫°ng th√¥ng b√°o ph·∫ßn m·ªÅm kh√¥ng ƒë·ªìng b·ªô ƒë∆∞·ª£c g·ª≠i ƒë·∫øn m·ªôt ti·∫øn tr√¨nh ƒë·ªÉ th√¥ng b√°o v·ªÅ m·ªôt s·ª± ki·ªán. N√≥ l√† m·ªôt c∆° ch·∫ø Giao ti·∫øp gi·ªØa c√°c ti·∫øn tr√¨nh (IPC) r·∫•t c∆° b·∫£n.</p>
                <p>C√°c t√≠n hi·ªáu ph·ªï bi·∫øn:</p>
                <ul>
                    <li><code>SIGINT (Ctrl+C)</code>: Ng·∫Øt t·ª´ terminal.</li>
                    <li><code>SIGTERM</code>: Y√™u c·∫ßu k·∫øt th√∫c (terminate) m·ªôt c√°ch duy√™n d√°ng.</li>
                    <li><code>SIGKILL</code>: Bu·ªôc k·∫øt th√∫c ngay l·∫≠p t·ª©c (kh√¥ng th·ªÉ b·ªã b·∫Øt ho·∫∑c b·ªè qua).</li>
                    <li><code>SIGSEGV</code>: L·ªói ph√¢n ƒëo·∫°n b·ªô nh·ªõ (segmentation fault).</li>
                    <li><code>SIGCHLD</code>: G·ª≠i ƒë·∫øn ti·∫øn tr√¨nh cha khi m·ªôt ti·∫øn tr√¨nh con k·∫øt th√∫c.</li>
                </ul>

                <h3>4.2. G·ª≠i v√† X·ª≠ l√Ω T√≠n hi·ªáu</h3>
                <ul>
                    <li><strong>G·ª≠i t√≠n hi·ªáu:</strong> D√πng l·ªánh <code>kill &lt;PID&gt;</code> ho·∫∑c h√†m <code>kill(pid_t pid, int sig)</code> trong C++.</li>
                    <li><strong>X·ª≠ l√Ω t√≠n hi·ªáu:</strong>
                        <ul>
                            <li><strong>H√†nh ƒë·ªông m·∫∑c ƒë·ªãnh:</strong> M·ªói t√≠n hi·ªáu c√≥ m·ªôt h√†nh ƒë·ªông m·∫∑c ƒë·ªãnh (v√≠ d·ª•: k·∫øt th√∫c ti·∫øn tr√¨nh, b·ªè qua, ...).</li>
                            <li><strong>B·∫Øt t√≠n hi·ªáu (Catching):</strong> M·ªôt ti·∫øn tr√¨nh c√≥ th·ªÉ ƒëƒÉng k√Ω m·ªôt h√†m x·ª≠ l√Ω (signal handler) ƒë·ªÉ th·ª±c thi m√£ t√πy ch·ªânh khi nh·∫≠n ƒë∆∞·ª£c t√≠n hi·ªáu.</li>
                            <li><strong>B·ªè qua t√≠n hi·ªáu (Ignoring):</strong> Y√™u c·∫ßu kernel b·ªè qua t√≠n hi·ªáu (tr·ª´ <code>SIGKILL</code> v√† <code>SIGSTOP</code>).</li>
                        </ul>
                    </li>
                </ul>
                <p>H√†m <strong><code>sigaction()</code></strong> l√† c√°ch hi·ªán ƒë·∫°i v√† ƒë∆∞·ª£c khuy·∫øn ngh·ªã ƒë·ªÉ x·ª≠ l√Ω t√≠n hi·ªáu, v√¨ n√≥ cung c·∫•p nhi·ªÅu quy·ªÅn ki·ªÉm so√°t h∆°n so v·ªõi h√†m <code>signal()</code> c≈©.</p>
<pre><code class="language-cpp">#include &lt;signal.h&gt;
#include &lt;unistd.h&gt;

void handle_sigint(int sig) {
    write(STDOUT_FILENO, "Caught SIGINT!\n", 15);
}

int main() {
    struct sigaction sa;
    sa.sa_handler = handle_sigint;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = 0;

    sigaction(SIGINT, &sa, NULL); // ƒêƒÉng k√Ω handler cho SIGINT

    while(1) {
        sleep(1);
    }
    return 0;
}
</code></pre>
                <div class="pitfall-box">
                    <p><strong>C·∫°m b·∫´y:</strong> C√°c h√†m x·ª≠ l√Ω t√≠n hi·ªáu ph·∫£i l√† <strong>re-entrant</strong>. Ch√∫ng c√≥ th·ªÉ b·ªã g·ªçi b·∫•t c·ª© l√∫c n√†o, ngay c·∫£ khi ch∆∞∆°ng tr√¨nh ƒëang ·ªü gi·ªØa m·ªôt l·ªùi g·ªçi h√†m kh√°c. Tr√°nh s·ª≠ d·ª•ng c√°c h√†m kh√¥ng an to√†n (non-reentrant) nh∆∞ `printf` ho·∫∑c `malloc` b√™n trong handler. H√£y d√πng c√°c h√†m an to√†n nh∆∞ `write`.</p>
                </div>

                <h3>4.3. Ch·∫∑n v√† Ch·ªù T√≠n hi·ªáu</h3>
                <ul>
                    <li><strong><code>sa_mask</code>:</strong> Khi ƒë·ªãnh nghƒ©a m·ªôt <code>sigaction</code>, b·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh m·ªôt t·∫≠p h·ª£p c√°c t√≠n hi·ªáu s·∫Ω b·ªã t·∫°m th·ªùi ch·∫∑n trong khi handler ƒëang th·ª±c thi.</li>
                    <li><strong><code>sigsuspend()</code>:</strong> M·ªôt h√†m quan tr·ªçng cho ph√©p m·ªôt ti·∫øn tr√¨nh t·∫°m th·ªùi thay th·∫ø signal mask c·ªßa n√≥ v√† t·ª± ƒë∆∞a m√¨nh v√†o tr·∫°ng th√°i ng·ªß cho ƒë·∫øn khi m·ªôt t√≠n hi·ªáu kh√¥ng b·ªã ch·∫∑n ƒë∆∞·ª£c g·ª≠i ƒë·∫øn. ƒê√¢y l√† c√°ch an to√†n ƒë·ªÉ ch·ªù t√≠n hi·ªáu m√† kh√¥ng g√¢y ra race condition.</li>
                </ul>
            </section>

            <section id="concurrency-posix-threads" class="content-section">
                <h1>POSIX Threads (pthreads) üßµ</h1>
                <p><strong>Lu·ªìng (Thread)</strong> l√† m·ªôt ƒë∆°n v·ªã th·ª±c thi "nh·∫π" h∆°n m·ªôt ti·∫øn tr√¨nh. Nhi·ªÅu lu·ªìng c√≥ th·ªÉ t·ªìn t·∫°i b√™n trong m·ªôt ti·∫øn tr√¨nh duy nh·∫•t, chia s·∫ª c√πng kh√¥ng gian b·ªô nh·ªõ (m√£ l·ªánh, d·ªØ li·ªáu, heap) nh∆∞ng c√≥ stack v√† thanh ghi ri√™ng. ƒêi·ªÅu n√†y cho ph√©p ch√∫ng th·ª±c hi·ªán c√°c t√°c v·ª• song song m·ªôt c√°ch hi·ªáu qu·∫£.</p>

                <h2>Module 1: Gi·ªõi thi·ªáu v·ªÅ Lu·ªìng</h2>
                <h3>1.1. Lu·ªìng vs. Ti·∫øn tr√¨nh</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Ti√™u ch√≠</th>
                            <th>Ti·∫øn tr√¨nh (Process)</th>
                            <th>Lu·ªìng (Thread)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Kh√¥ng gian nh·ªõ</strong></td>
                            <td>ƒê·ªôc l·∫≠p, c√°ch ly</td>
                            <td>Chia s·∫ª (data, code, heap), stack ri√™ng</td>
                        </tr>
                        <tr>
                            <td><strong>T·∫°o m·ªõi</strong></td>
                            <td>Ch·∫≠m, t·ªën t√†i nguy√™n (`fork()`)</td>
                            <td>Nhanh, nh·∫π h∆°n (`pthread_create()`)</td>
                        </tr>
                        <tr>
                            <td><strong>Giao ti·∫øp (IPC)</strong></td>
                            <td>Ph·ª©c t·∫°p (pipes, sockets, shared memory)</td>
                            <td>ƒê∆°n gi·∫£n (bi·∫øn to√†n c·ª•c, con tr·ªè)</td>
                        </tr>
                        <tr>
                            <td><strong>C√°ch ly l·ªói</strong></td>
                            <td>T·ªët (m·ªôt process crash kh√¥ng ·∫£nh h∆∞·ªüng process kh√°c)</td>
                            <td>K√©m (m·ªôt thread crash l√†m c·∫£ process crash)</td>
                        </tr>
                    </tbody>
                </table>
                <img src="images/process_vs_thread.svg" alt="Process vs. Thread Memory Model">

                <hr>
                <h2>Module 2: V√≤ng ƒë·ªùi c·ªßa Lu·ªìng</h2>
                <h3>2.1. T·∫°o v√† K·∫øt th√∫c Lu·ªìng</h3>
                <ul>
                    <li><strong><code>pthread_create()</code>:</strong> T·∫°o m·ªôt lu·ªìng m·ªõi.
<pre><code class="language-cpp">#include &lt;pthread.h&gt;
// int pthread_create(pthread_t *thread, const pthread_attr_t *attr,
//                    void *(*start_routine) (void *), void *arg);
</code></pre>
                        <ul>
                            <li><code>thread</code>: Con tr·ªè ƒë·ªÉ l∆∞u ID c·ªßa lu·ªìng m·ªõi.</li>
                            <li><code>attr</code>: Thu·ªôc t√≠nh c·ªßa lu·ªìng (th∆∞·ªùng l√† `NULL` cho m·∫∑c ƒë·ªãnh).</li>
                            <li><code>start_routine</code>: Con tr·ªè t·ªõi h√†m m√† lu·ªìng s·∫Ω th·ª±c thi.</li>
                            <li><code>arg</code>: ƒê·ªëi s·ªë ƒë∆∞·ª£c truy·ªÅn cho `start_routine`.</li>
                        </ul>
                    </li>
                    <li><strong><code>pthread_join()</code>:</strong> Ch·ªù m·ªôt lu·ªìng k·∫øt th√∫c v√† thu th·∫≠p gi√° tr·ªã tr·∫£ v·ªÅ c·ªßa n√≥. T∆∞∆°ng t·ª± nh∆∞ `wait()` cho ti·∫øn tr√¨nh.
<pre><code class="language-cpp">#include &lt;pthread.h&gt;
// int pthread_join(pthread_t thread, void **retval);
</code></pre>
                    </li>
                    <li><strong><code>pthread_exit()</code>:</strong> Cho ph√©p m·ªôt lu·ªìng t·ª± k·∫øt th√∫c v√† tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã.</li>
                    <li><strong><code>pthread_self()</code>:</strong> L·∫•y ID c·ªßa lu·ªìng ƒëang th·ª±c thi.</li>
                </ul>

                <hr>
                <h2>Module 3: ƒê·ªìng b·ªô h√≥a Lu·ªìng (Synchronization)</h2>
                <p>Khi nhi·ªÅu lu·ªìng c√πng truy c·∫≠p v√†o d·ªØ li·ªáu chia s·∫ª, c√°c v·∫•n ƒë·ªÅ nh∆∞ <strong>ƒëi·ªÅu ki·ªán tranh ch·∫•p (race conditions)</strong> c√≥ th·ªÉ x·∫£y ra. ƒê·ªìng b·ªô h√≥a l√† c·∫ßn thi·∫øt ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn d·ªØ li·ªáu.</p>

                <h3>3.1. Mutex (Mutual Exclusion)</h3>
                <p><strong>Mutex</strong> l√† m·ªôt kh√≥a b·∫£o v·ªá. Ch·ªâ lu·ªìng n√†o gi·ªØ ƒë∆∞·ª£c kh√≥a m·ªõi ƒë∆∞·ª£c ph√©p ƒëi v√†o "v√πng gƒÉng" (critical section) - ƒëo·∫°n code truy c·∫≠p t√†i nguy√™n chia s·∫ª.</p>
                <ul>
                    <li><code>pthread_mutex_init()</code> / `PTHREAD_MUTEX_INITIALIZER`: Kh·ªüi t·∫°o mutex.</li>
                    <li><code>pthread_mutex_lock()</code>: Y√™u c·∫ßu kh√≥a. N·∫øu kh√≥a ƒë√£ b·ªã gi·ªØ, lu·ªìng s·∫Ω b·ªã ch·∫∑n.</li>
                    <li><code>pthread_mutex_unlock()</code>: M·ªü kh√≥a.</li>
                    <li><code>pthread_mutex_destroy()</code>: H·ªßy mutex.</li>
                </ul>
<pre><code class="language-cpp">pthread_mutex_t my_mutex = PTHREAD_MUTEX_INITIALIZER;
int shared_variable = 0;

void* thread_function(void* arg) {
    pthread_mutex_lock(&my_mutex);
    // --- V√πng gƒÉng b·∫Øt ƒë·∫ßu ---
    shared_variable++;
    // --- V√πng gƒÉng k·∫øt th√∫c ---
    pthread_mutex_unlock(&my_mutex);
    return NULL;
}
</code></pre>

                <h3>3.2. Condition Variables</h3>
                <p><strong>Bi·∫øn ƒëi·ªÅu ki·ªán (Condition Variable)</strong> cho ph√©p c√°c lu·ªìng ch·ªù ƒë·ª£i m·ªôt ƒëi·ªÅu ki·ªán c·ª• th·ªÉ tr·ªü th√†nh `true`. Ch√∫ng lu√¥n ƒë∆∞·ª£c s·ª≠ d·ª•ng c√πng v·ªõi m·ªôt mutex.</p>
                <ul>
                    <li><code>pthread_cond_init()</code>: Kh·ªüi t·∫°o bi·∫øn ƒëi·ªÅu ki·ªán.</li>
                    <li><code>pthread_cond_wait()</code>: M·ªü kh√≥a mutex v√† ƒë∆∞a lu·ªìng v√†o tr·∫°ng th√°i ng·ªß. Khi ƒë∆∞·ª£c ƒë√°nh th·ª©c, n√≥ s·∫Ω t·ª± ƒë·ªông kh√≥a l·∫°i mutex tr∆∞·ªõc khi ti·∫øp t·ª•c.</li>
                    <li><code>pthread_cond_signal()</code>: ƒê√°nh th·ª©c <strong>m·ªôt</strong> lu·ªìng ƒëang ch·ªù.</li>
                    <li><code>pthread_cond_broadcast()</code>: ƒê√°nh th·ª©c <strong>t·∫•t c·∫£</strong> c√°c lu·ªìng ƒëang ch·ªù.</li>
                </ul>
                <p>ƒê√¢y l√† c∆° ch·∫ø n·ªÅn t·∫£ng ƒë·ªÉ x√¢y d·ª±ng c√°c m√¥ h√¨nh s·∫£n xu·∫•t-ti√™u d√πng (producer-consumer) an to√†n.</p>

                <h3>3.3. Semaphores</h3>
                <p><strong>Semaphore</strong> l√† m·ªôt b·ªô ƒë·∫øm t·ªïng qu√°t ƒë∆∞·ª£c d√πng ƒë·ªÉ ki·ªÉm so√°t truy c·∫≠p v√†o m·ªôt t√†i nguy√™n c√≥ gi·ªõi h·∫°n s·ªë l∆∞·ª£ng. V√≠ d·ª•, qu·∫£n l√Ω m·ªôt "b·ªÉ" (pool) g·ªìm N k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu.</p>
                <ul>
                    <li><code>sem_init()</code>: Kh·ªüi t·∫°o semaphore v·ªõi m·ªôt gi√° tr·ªã ban ƒë·∫ßu.</li>
                    <li><code>sem_wait()</code>: Gi·∫£m b·ªô ƒë·∫øm. N·∫øu b·ªô ƒë·∫øm l√† 0, lu·ªìng s·∫Ω b·ªã ch·∫∑n.</li>
                    <li><code>sem_post()</code>: TƒÉng b·ªô ƒë·∫øm, c√≥ th·ªÉ ƒë√°nh th·ª©c m·ªôt lu·ªìng ƒëang ch·ªù.</li>
                </ul>

                <hr>
                <h2>Module 4: Thu·ªôc t√≠nh Lu·ªìng</h2>
                <p>S·ª≠ d·ª•ng ƒë·ªëi t∆∞·ª£ng <code>pthread_attr_t</code> ƒë·ªÉ t√πy ch·ªânh h√†nh vi c·ªßa lu·ªìng tr∆∞·ªõc khi t·∫°o.</p>
                <ul>
                    <li><strong>Tr·∫°ng th√°i t√°ch r·ªùi (Detach State):</strong>
                        <ul>
                            <li><code>PTHREAD_CREATE_JOINABLE</code> (m·∫∑c ƒë·ªãnh): Lu·ªìng c√≥ th·ªÉ ƒë∆∞·ª£c `pthread_join()`. T√†i nguy√™n c·ªßa n√≥ ƒë∆∞·ª£c gi·ªØ l·∫°i cho ƒë·∫øn khi ƒë∆∞·ª£c join.</li>
                            <li><code>PTHREAD_CREATE_DETACHED</code>: Lu·ªìng "t√°ch r·ªùi". Khi n√≥ k·∫øt th√∫c, t√†i nguy√™n c·ªßa n√≥ ƒë∆∞·ª£c t·ª± ƒë·ªông gi·∫£i ph√≥ng. Kh√¥ng th·ªÉ join lu·ªìng detached. D√πng <code>pthread_detach()</code> ƒë·ªÉ t√°ch r·ªùi m·ªôt lu·ªìng ƒë√£ t·∫°o.</li>
                        </ul>
                    </li>
                    <li><strong>L·∫≠p l·ªãch (Scheduling):</strong>
                        <ul>
                            <li><code>SCHED_OTHER</code>: M·∫∑c ƒë·ªãnh, chia s·∫ª th·ªùi gian th√¥ng th∆∞·ªùng.</li>
                            <li><code>SCHED_FIFO</code> / <code>SCHED_RR</code>: L·∫≠p l·ªãch th·ªùi gian th·ª±c, c·∫ßn quy·ªÅn `root`. Lu·ªìng ∆∞u ti√™n cao h∆°n s·∫Ω ch·∫°y tr∆∞·ªõc.</li>
                        </ul>
                    </li>
                </ul>

                <hr>
                <h2>Module 5: H·ªßy m·ªôt Lu·ªìng</h2>
                <ul>
                    <li><strong><code>pthread_cancel()</code>:</strong> G·ª≠i m·ªôt y√™u c·∫ßu h·ªßy ƒë·∫øn m·ªôt lu·ªìng kh√°c.</li>
                    <li>Lu·ªìng nh·∫≠n y√™u c·∫ßu c√≥ th·ªÉ ki·ªÉm so√°t c√°ch n√≥ ph·∫£n ·ª©ng:
                        <ul>
                            <li><strong>State:</strong> `PTHREAD_CANCEL_ENABLE` (cho ph√©p h·ªßy) vs. `PTHREAD_CANCEL_DISABLE` (t·∫°m th·ªùi b·ªè qua y√™u c·∫ßu).</li>
                            <li><strong>Type:</strong> `PTHREAD_CANCEL_DEFERRED` (ch·ªâ h·ªßy t·∫°i c√°c ƒëi·ªÉm h·ªßy b·ªè - an to√†n) vs. `PTHREAD_CANCEL_ASYNCHRONOUS` (h·ªßy ngay l·∫≠p t·ª©c - kh√¥ng an to√†n).</li>
                        </ul>
                    </li>
                    <li><strong>ƒêi·ªÉm h·ªßy b·ªè (Cancellation Points):</strong> C√°c h√†m nh∆∞ `read`, `write`, `sleep`, `pthread_join` l√† c√°c ƒëi·ªÉm h·ªßy b·ªè. <code>pthread_testcancel()</code> c√≥ th·ªÉ ƒë∆∞·ª£c d√πng ƒë·ªÉ t·∫°o m·ªôt ƒëi·ªÉm h·ªßy b·ªè t∆∞·ªùng minh.</li>
                    <li><strong>Clean-up Handlers (<code>pthread_cleanup_push/pop</code>):</strong> ƒêƒÉng k√Ω c√°c h√†m s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c g·ªçi khi lu·ªìng b·ªã h·ªßy, ƒë·∫£m b·∫£o t√†i nguy√™n (nh∆∞ mutex) ƒë∆∞·ª£c gi·∫£i ph√≥ng.</li>
                </ul>

                <hr>
                <h2>Module 6: L√†m vi·ªác v·ªõi nhi·ªÅu Lu·ªìng</h2>
                <p>Khi t·∫°o nhi·ªÅu lu·ªìng trong m·ªôt v√≤ng l·∫∑p, c·∫©n th·∫≠n kh√¥ng truy·ªÅn ƒë·ªãa ch·ªâ c·ªßa c√πng m·ªôt bi·∫øn l·∫∑p cho t·∫•t c·∫£ c√°c lu·ªìng. ƒê√¢y l√† m·ªôt l·ªói ph·ªï bi·∫øn g√¢y ra race condition.</p>
                <div class="pitfall-box">
<pre><code class="language-cpp">// L·ªñI PH·ªî BI·∫æN
for (int i = 0; i < 5; i++) {
    // T·∫•t c·∫£ c√°c lu·ªìng c√≥ th·ªÉ nh·∫≠n c√πng m·ªôt gi√° tr·ªã cu·ªëi c√πng c·ªßa 'i'
    pthread_create(&tid, NULL, worker, &i);
}
</code></pre>
                </div>
                <p><strong>Gi·∫£i ph√°p:</strong> Truy·ªÅn gi√° tr·ªã c·ªßa bi·∫øn l·∫∑p, ho·∫∑c c·∫•p ph√°t b·ªô nh·ªõ ƒë·ªông cho m·ªói ƒë·ªëi s·ªë.</p>
                <p>Kh√°i ni·ªám <strong>Thread Pool</strong> l√† m·ªôt m·∫´u thi·∫øt k·∫ø hi·ªáu qu·∫£: t·∫°o m·ªôt s·ªë l∆∞·ª£ng lu·ªìng c·ªë ƒë·ªãnh v√† ph√¢n ph·ªëi c√¥ng vi·ªác cho ch√∫ng, tr√°nh overhead c·ªßa vi·ªác t·∫°o v√† h·ªßy lu·ªìng li√™n t·ª•c.</p>

            </section>

            <section id="concurrency-python" class="content-section">
                <h1>L·∫≠p tr√¨nh ƒë·ªìng th·ªùi trong Python üêç</h1>
                <p>Python cung c·∫•p nhi·ªÅu c√¥ng c·ª• ƒë·ªÉ l·∫≠p tr√¨nh ƒë·ªìng th·ªùi, nh∆∞ng ƒëi·ªÅu quan tr·ªçng l√† ph·∫£i hi·ªÉu s·ª± kh√°c bi·ªát gi·ªØa c√°c module v√† m·ªôt kh√°i ni·ªám c·ªët l√µi g·ªçi l√† <strong>Global Interpreter Lock (GIL)</strong>.</p>

                <h2>1. Global Interpreter Lock (GIL) - N√∫t th·∫Øt c·ªï chai</h2>
                <p><strong>GIL</strong> l√† m·ªôt mutex c·∫•p ti·∫øn tr√¨nh (process-level) trong CPython (b·∫£n c√†i ƒë·∫∑t Python ph·ªï bi·∫øn nh·∫•t) c√≥ t√°c d·ª•ng <strong>ch·ªâ cho ph√©p m·ªôt lu·ªìng th·ª±c thi bytecode Python t·∫°i m·ªôt th·ªùi ƒëi·ªÉm</strong>. Ngay c·∫£ tr√™n m·ªôt CPU ƒëa l√µi, nhi·ªÅu lu·ªìng Python s·∫Ω kh√¥ng bao gi·ªù ch·∫°y song song th·ª±c s·ª± (true parallelism) cho c√°c t√°c v·ª• t·ªën CPU.</p>
                <ul>
                    <li><strong>T·∫°i sao GIL t·ªìn t·∫°i?</strong> N√≥ gi√∫p ƒë∆°n gi·∫£n h√≥a vi·ªác qu·∫£n l√Ω b·ªô nh·ªõ trong CPython, l√†m cho vi·ªác t√≠ch h·ª£p c√°c th∆∞ vi·ªán C kh√¥ng thread-safe tr·ªü n√™n d·ªÖ d√†ng h∆°n.</li>
                    <li><strong>Khi n√†o GIL l√† v·∫•n ƒë·ªÅ?</strong> ƒê·ªëi v·ªõi c√°c t√°c v·ª• <strong>CPU-bound</strong> (t√≠nh to√°n n·∫∑ng nh∆∞ x·ª≠ l√Ω ·∫£nh, machine learning), GIL tr·ªü th√†nh m·ªôt n√∫t th·∫Øt c·ªï chai nghi√™m tr·ªçng.</li>
                    <li><strong>Khi n√†o GIL kh√¥ng ph·∫£i l√† v·∫•n ƒë·ªÅ?</strong> ƒê·ªëi v·ªõi c√°c t√°c v·ª• <strong>I/O-bound</strong> (ch·ªù m·∫°ng, ƒë·ªçc/ghi file, truy v·∫•n database), GIL kh√¥ng ·∫£nh h∆∞·ªüng nhi·ªÅu. Khi m·ªôt lu·ªìng ƒëang ch·ªù I/O, Python s·∫Ω gi·∫£i ph√≥ng GIL, cho ph√©p m·ªôt lu·ªìng kh√°c ch·∫°y.</li>
                </ul>
                <img src="images/python_gil.svg" alt="Python GIL Explanation">

                <hr>
                <h2>2. Module <code>threading</code></h2>
                <p>Module <code>threading</code> c·ªßa Python t·∫°o ra c√°c lu·ªìng ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi h·ªá ƒëi·ªÅu h√†nh. Tuy nhi√™n, do GIL, ch√∫ng ph√π h·ª£p nh·∫•t cho c√°c t√°c v·ª• I/O-bound.</p>
<pre><code class="language-python">import threading
import time

def network_task(name):
    print(f"Thread {name}: B·∫Øt ƒë·∫ßu t·∫£i xu·ªëng...")
    time.sleep(2) # Gi·∫£ l·∫≠p ch·ªù m·∫°ng
    print(f"Thread {name}: T·∫£i xu·ªëng ho√†n t·∫•t.")

# T·∫°o v√† kh·ªüi ch·∫°y nhi·ªÅu lu·ªìng
threads = []
for i in range(5):
    t = threading.Thread(target=network_task, args=(i,))
    threads.append(t)
    t.start()

# Ch·ªù t·∫•t c·∫£ c√°c lu·ªìng ho√†n th√†nh
for t in threads:
    t.join()

print("T·∫•t c·∫£ c√°c t√°c v·ª• m·∫°ng ƒë√£ ho√†n th√†nh.")
</code></pre>
                <p>Trong v√≠ d·ª• tr√™n, m·∫∑c d√π c√≥ 5 lu·ªìng, t·ªïng th·ªùi gian ch·∫°y s·∫Ω ch·ªâ kho·∫£ng 2 gi√¢y (thay v√¨ 10 gi√¢y) v√¨ c√°c lu·ªìng c√≥ th·ªÉ "ch·ªù" m·∫°ng m·ªôt c√°ch ƒë·ªìng th·ªùi. GIL ƒë∆∞·ª£c gi·∫£i ph√≥ng trong l√∫c `time.sleep()`.</p>

                <hr>
                <h2>3. Module <code>multiprocessing</code></h2>
                <p>Module <code>multiprocessing</code> l√† gi·∫£i ph√°p c·ªßa Python ƒë·ªÉ v∆∞·ª£t qua GIL cho c√°c t√°c v·ª• CPU-bound. Thay v√¨ t·∫°o lu·ªìng, n√≥ t·∫°o ra c√°c <strong>ti·∫øn tr√¨nh (processes)</strong> con ri√™ng bi·ªát.</p>
                <ul>
                    <li>M·ªói ti·∫øn tr√¨nh c√≥ b·ªô nh·ªõ v√† tr√¨nh th√¥ng d·ªãch Python ri√™ng, do ƒë√≥ kh√¥ng b·ªã ·∫£nh h∆∞·ªüng b·ªüi GIL c·ªßa ti·∫øn tr√¨nh kh√°c.</li>
                    <li>ƒêi·ªÅu n√†y cho ph√©p ƒë·∫°t ƒë∆∞·ª£c <strong>t√≠nh song song th·ª±c s·ª± (true parallelism)</strong> tr√™n c√°c CPU ƒëa l√µi.</li>
                    <li>Giao ti·∫øp gi·ªØa c√°c ti·∫øn tr√¨nh (IPC) ph·ª©c t·∫°p h∆°n so v·ªõi lu·ªìng v√† c·∫ßn c√°c c∆° ch·∫ø nh∆∞ <code>Queue</code>, <code>Pipe</code>.</li>
                </ul>
<pre><code class="language-python">import multiprocessing
import time

def cpu_task(name):
    print(f"Process {name}: B·∫Øt ƒë·∫ßu t√≠nh to√°n...")
    # Gi·∫£ l·∫≠p m·ªôt t√°c v·ª• t√≠nh to√°n n·∫∑ng
    count = 0
    for i in range(10**7):
        count += i
    print(f"Process {name}: T√≠nh to√°n ho√†n t·∫•t.")

# T·∫°o v√† kh·ªüi ch·∫°y nhi·ªÅu ti·∫øn tr√¨nh
processes = []
if __name__ == "__main__": # C·∫ßn thi·∫øt tr√™n m·ªôt s·ªë HƒêH
    for i in range(4): # Gi·∫£ s·ª≠ c√≥ 4 l√µi CPU
        p = multiprocessing.Process(target=cpu_task, args=(i,))
        processes.append(p)
        p.start()

    # Ch·ªù t·∫•t c·∫£ c√°c ti·∫øn tr√¨nh ho√†n th√†nh
    for p in processes:
        p.join()

    print("T·∫•t c·∫£ c√°c t√°c v·ª• CPU ƒë√£ ho√†n th√†nh.")
</code></pre>
                <p>N·∫øu ch·∫°y ƒëo·∫°n code tr√™n, b·∫°n s·∫Ω th·∫•y 4 ti·∫øn tr√¨nh th·ª±c s·ª± ch·∫°y song song tr√™n 4 l√µi CPU, gi√∫p gi·∫£m ƒë√°ng k·ªÉ t·ªïng th·ªùi gian ho√†n th√†nh so v·ªõi vi·ªác ch·∫°y tu·∫ßn t·ª±.</p>

                <hr>
                <h2>4. So s√°nh <code>threading</code> vs. <code>multiprocessing</code></h2>
                <table>
                    <thead>
                        <tr>
                            <th>Ti√™u ch√≠</th>
                            <th><code>threading</code></th>
                            <th><code>multiprocessing</code></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng</strong></td>
                            <td>I/O-bound (ch·ªù m·∫°ng, file, DB)</td>
                            <td>CPU-bound (t√≠nh to√°n, x·ª≠ l√Ω d·ªØ li·ªáu)</td>
                        </tr>
                        <tr>
                            <td><strong>Song song th·ª±c s·ª±</strong></td>
                            <td>Kh√¥ng (do GIL)</td>
                            <td>C√≥ (m·ªói ti·∫øn tr√¨nh c√≥ GIL ri√™ng)</td>
                        </tr>
                        <tr>
                            <td><strong>Chia s·∫ª b·ªô nh·ªõ</strong></td>
                            <td>D·ªÖ d√†ng (d√πng bi·∫øn chung)</td>
                            <td>Kh√≥ (c·∫ßn IPC nh∆∞ Queues, Pipes)</td>
                        </tr>
                        <tr>
                            <td><strong>Overhead</strong></td>
                            <td>Th·∫•p</td>
                            <td>Cao (t·∫°o ti·∫øn tr√¨nh t·ªën k√©m h∆°n)</td>
                        </tr>
                    </tbody>
                </table>
                <blockquote>
                    <p><strong>Quy t·∫Øc v√†ng:</strong> D√πng <strong><code>threading</code></strong> cho c√°c t√°c v·ª• b·ªã ch·∫∑n b·ªüi I/O. D√πng <strong><code>multiprocessing</code></strong> cho c√°c t√°c v·ª• b·ªã gi·ªõi h·∫°n b·ªüi s·ª©c m·∫°nh c·ªßa CPU.</p>
                </blockquote>
            </section>
        </main>
    </div>

    <div id="answer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            <div id="modal-answer-content">
                <!-- Answer content will be injected here by JS -->
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
